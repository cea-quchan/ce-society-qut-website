// تنظیمات generator و datasource

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// مدل User
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  password  String
  role      String
  points    Int      @default(0)
  image     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  active    Boolean  @default(true)
  // روابط
  articles      Article[]
  events        Event[]        @relation("OrganizerEvents")
  competitions  Competition[]  @relation("OrganizerCompetitions")
  courses       Course[]       @relation("InstructorCourses")
  chatMessages  ChatMessage[]
  chatGroups    ChatGroupMember[]
  libraryResources LibraryResource[] @relation("AuthorLibraryResources")
  libraryComments  LibraryComment[]  @relation("AuthorLibraryComments")
  pointsHistory Points[]
  pollVotes     PollVote[]
  webinarComments WebinarComment[]
  webinarParticipants WebinarParticipant[]
  pollsCreated Poll[]        @relation("PollsCreatedByUser")
  webinarsHosted Webinar[]   @relation("WebinarsHostedByUser")
  newsCreated News[]         @relation("NewsCreatedByUser")
  galleryItems  GalleryItem[]
  notifications Notification[]
  reports       Report[]
  restores      Restore[]
  backups       Backup[]
  payments      Payment[]
}

// مدل Article
model Article {
  id        String   @id @default(uuid())
  title     String
  content   String
  published Boolean  @default(false)
  author    User     @relation(fields: [authorId], references: [id])
  authorId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// مدل Event
model Event {
  id          String   @id @default(uuid())
  title       String
  description String
  startDate   DateTime
  endDate     DateTime
  location    String
  capacity    Int
  organizer   User     @relation("OrganizerEvents", fields: [organizerId], references: [id])
  organizerId String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// مدل Competition
model Competition {
  id             String   @id @default(uuid())
  title          String
  description    String
  startDate      DateTime
  endDate        DateTime
  status         String
  rules          String
  prize          String
  maxParticipants Int
  location       String
  image          String?
  organizer      User     @relation("OrganizerCompetitions", fields: [organizerId], references: [id])
  organizerId    String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

// مدل Course
model Course {
  id          String   @id @default(uuid())
  title       String
  description String
  price       Float
  published   Boolean  @default(false)
  startDate   DateTime
  endDate     DateTime
  capacity    Int
  instructor  User     @relation("InstructorCourses", fields: [instructorId], references: [id])
  instructorId String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// مدل Library
model LibraryCategory {
  id          String   @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  resources   LibraryResource[]
}

model LibraryTag {
  id        String   @id @default(uuid())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model LibraryResource {
  id          String   @id @default(uuid())
  title       String
  description String
  content     String
  fileUrl     String
  author      User     @relation("AuthorLibraryResources", fields: [authorId], references: [id])
  authorId    String
  category    LibraryCategory @relation(fields: [categoryId], references: [id])
  categoryId  String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  comments    LibraryComment[]
}

model LibraryComment {
  id          String   @id @default(uuid())
  resource    LibraryResource @relation(fields: [resourceId], references: [id])
  resourceId  String
  author      User     @relation("AuthorLibraryComments", fields: [authorId], references: [id])
  authorId    String
  content     String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// مدل Points
model Points {
  id          String   @id @default(uuid())
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  amount      Int
  activity    String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// مدل Poll
model Poll {
  id          String   @id @default(uuid())
  title       String
  description String
  creator     User     @relation("PollsCreatedByUser", fields: [creatorId], references: [id])
  creatorId   String
  status      String
  endDate     DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  options     PollOption[]
  votes       PollVote[]
}

model PollOption {
  id        String   @id @default(uuid())
  poll      Poll     @relation(fields: [pollId], references: [id])
  pollId    String
  text      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  votes     PollVote[]
}

model PollVote {
  id        String   @id @default(uuid())
  poll      Poll     @relation(fields: [pollId], references: [id])
  pollId    String
  option    PollOption @relation(fields: [optionId], references: [id])
  optionId  String
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  createdAt DateTime @default(now())
}

// مدل Webinar
model Webinar {
  id              String   @id @default(uuid())
  title           String
  description     String
  startTime       DateTime
  duration        Int
  maxParticipants Int
  meetingLink     String
  host            User     @relation("WebinarsHostedByUser", fields: [hostId], references: [id])
  hostId          String
  status          String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  participants    WebinarParticipant[]
  comments        WebinarComment[]
}

model WebinarParticipant {
  id         String   @id @default(uuid())
  webinar    Webinar  @relation(fields: [webinarId], references: [id])
  webinarId  String
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  joinedAt   DateTime?
  leftAt     DateTime?
}

model WebinarComment {
  id         String   @id @default(uuid())
  webinar    Webinar  @relation(fields: [webinarId], references: [id])
  webinarId  String
  author     User     @relation(fields: [authorId], references: [id])
  authorId   String
  content    String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

// مدل Chat
model ChatGroup {
  id          String   @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  members     ChatGroupMember[]
  messages    ChatMessage[]
}

model ChatMessage {
  id        String   @id @default(uuid())
  group     ChatGroup @relation(fields: [groupId], references: [id])
  groupId   String
  sender    User     @relation(fields: [senderId], references: [id])
  senderId  String
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ChatGroupMember {
  id        String   @id @default(uuid())
  group     ChatGroup @relation(fields: [groupId], references: [id])
  groupId   String
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  role      String
  joinedAt  DateTime
}

model News {
  id        String   @id @default(uuid())
  title     String
  content   String
  summary   String?
  date      DateTime @default(now())
  author    User     @relation("NewsCreatedByUser", fields: [authorId], references: [id])
  authorId  String
  category  String
  published Boolean  @default(false)
  publishedAt DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  images    NewsImage[] @relation("NewsImages")
}

model NewsImage {
  id        String   @id @default(uuid())
  url       String
  alt       String?
  news      News     @relation("NewsImages", fields: [newsId], references: [id])
  newsId    String
  order     Int
}

model GalleryItem {
  id        String   @id @default(uuid())
  title     String
  imageUrl  String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
  userId    String
}

model HeroVideo {
  id          String   @id @default(uuid())
  videoUrl    String
  description String?
  platform    String   // youtube, aparat, faradars, maktabkhooneh, twitch, ...
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Settings {
  id             String   @id @default(uuid())
  siteName       String
  siteDescription String
  siteLogo       String
  siteFavicon    String
  siteKeywords   String
  siteLanguage   String   @default("fa")
  maintenanceMode Boolean @default(false)
  loginOpen      Boolean  @default(false)
  registrationOpen Boolean @default(false)
  heroOpen       Boolean  @default(true)
  statsActiveMembers   Int    @default(150)
  statsWorkshops       Int    @default(25)
  statsCompetitions    Int    @default(10)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Notification {
  id              String   @id @default(uuid())
  title           String
  message         String
  type            String
  read            Boolean @default(false)
  status          String  @default("sent")
  targetAudience  String?
  scheduledFor    DateTime?
  readCount       Int     @default(0)
  totalRecipients Int     @default(1)
  link            String?
  metadata        Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  userId          String
  user            User     @relation(fields: [userId], references: [id])
}

model Report {
  id          String   @id @default(uuid())
  type        String
  targetId    String
  targetType  String
  reason      String
  description String?
  status      String   @default("PENDING")
  adminNotes  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  reporterId  String
  reporter    User     @relation(fields: [reporterId], references: [id])
}

model Restore {
  id        String   @id @default(uuid())
  type      String
  data      Json
  status    String   @default("PENDING")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    String
  user      User     @relation(fields: [userId], references: [id])
}

model Backup {
  id          String   @id @default(uuid())
  filename    String
  size        String
  description String?
  createdAt   DateTime @default(now())
  createdBy   String
  userId      String
  user        User     @relation(fields: [userId], references: [id])
}

model Payment {
  id          String   @id @default(uuid())
  amount      Float
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  type        String
  description String?
  status      String   @default("PENDING")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Contact {
  id        String   @id @default(uuid())
  name      String
  email     String
  subject   String
  message   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
