"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/users";
exports.ids = ["pages/api/users"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "bcryptjs":
/*!***************************!*\
  !*** external "bcryptjs" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("bcryptjs");

/***/ }),

/***/ "ioredis":
/*!**************************!*\
  !*** external "ioredis" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("ioredis");

/***/ }),

/***/ "next-auth/react":
/*!**********************************!*\
  !*** external "next-auth/react" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("next-auth/react");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "winston":
/*!**************************!*\
  !*** external "winston" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("winston");

/***/ }),

/***/ "dompurify":
/*!****************************!*\
  !*** external "dompurify" ***!
  \****************************/
/***/ ((module) => {

module.exports = import("dompurify");;

/***/ }),

/***/ "html-escaper":
/*!*******************************!*\
  !*** external "html-escaper" ***!
  \*******************************/
/***/ ((module) => {

module.exports = import("html-escaper");;

/***/ }),

/***/ "zod":
/*!**********************!*\
  !*** external "zod" ***!
  \**********************/
/***/ ((module) => {

module.exports = import("zod");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fusers&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cusers%5Cindex.ts&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fusers&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cusers%5Cindex.ts&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _src_pages_api_users_index_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src\\pages\\api\\users\\index.ts */ \"(api)/./src/pages/api/users/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_src_pages_api_users_index_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_src_pages_api_users_index_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_users_index_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_users_index_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/users\",\n        pathname: \"/api/users\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _src_pages_api_users_index_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnVzZXJzJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGc3JjJTVDcGFnZXMlNUNhcGklNUN1c2VycyU1Q2luZGV4LnRzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQytEO0FBQy9EO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQywwREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsMERBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVELHFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZWR1Y2F0aW9uYWwtcGxhdGZvcm0vP2ZjY2IiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3NyY1xcXFxwYWdlc1xcXFxhcGlcXFxcdXNlcnNcXFxcaW5kZXgudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS91c2Vyc1wiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3VzZXJzXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fusers&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cusers%5Cindex.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./src/lib/errors.ts":
/*!***************************!*\
  !*** ./src/lib/errors.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuthenticationError: () => (/* binding */ AuthenticationError),\n/* harmony export */   AuthorizationError: () => (/* binding */ AuthorizationError),\n/* harmony export */   CacheError: () => (/* binding */ CacheError),\n/* harmony export */   DatabaseError: () => (/* binding */ DatabaseError),\n/* harmony export */   ExternalServiceError: () => (/* binding */ ExternalServiceError),\n/* harmony export */   FileUploadError: () => (/* binding */ FileUploadError),\n/* harmony export */   NotFoundError: () => (/* binding */ NotFoundError),\n/* harmony export */   RateLimitError: () => (/* binding */ RateLimitError),\n/* harmony export */   SocketError: () => (/* binding */ SocketError),\n/* harmony export */   ValidationError: () => (/* binding */ ValidationError)\n/* harmony export */ });\nclass ValidationError extends Error {\n    constructor(message, details){\n        super(message);\n        this.details = details;\n        this.name = \"ValidationError\";\n    }\n}\nclass AuthenticationError extends Error {\n    constructor(message = \"لطفا وارد حساب کاربری خود شوید\"){\n        super(message);\n        this.name = \"AuthenticationError\";\n    }\n}\nclass AuthorizationError extends Error {\n    constructor(message = \"شما دسترسی به این بخش را ندارید\"){\n        super(message);\n        this.name = \"AuthorizationError\";\n    }\n}\nclass NotFoundError extends Error {\n    constructor(message = \"مورد درخواستی یافت نشد\"){\n        super(message);\n        this.name = \"NotFoundError\";\n    }\n}\nclass DatabaseError extends Error {\n    constructor(message = \"خطا در پایگاه داده\"){\n        super(message);\n        this.name = \"DatabaseError\";\n    }\n}\nclass FileUploadError extends Error {\n    constructor(message = \"خطا در آپلود فایل\"){\n        super(message);\n        this.name = \"FileUploadError\";\n    }\n}\nclass RateLimitError extends Error {\n    constructor(message = \"تعداد درخواست‌های شما بیش از حد مجاز است\"){\n        super(message);\n        this.name = \"RateLimitError\";\n    }\n}\nclass SocketError extends Error {\n    constructor(message = \"خطا در ارتباط با سرور\"){\n        super(message);\n        this.name = \"SocketError\";\n    }\n}\nclass CacheError extends Error {\n    constructor(message = \"خطا در کش\"){\n        super(message);\n        this.name = \"CacheError\";\n    }\n}\nclass ExternalServiceError extends Error {\n    constructor(message = \"خطا در سرویس خارجی\", service){\n        super(message);\n        this.service = service;\n        this.name = \"ExternalServiceError\";\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL2Vycm9ycy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBRU8sTUFBTUEsd0JBQXdCQztJQUNuQ0MsWUFDRUMsT0FBZSxFQUNmLE9BRUMsQ0FDRDtRQUNBLEtBQUssQ0FBQ0E7YUFKQ0MsVUFBQUE7UUFLUCxJQUFJLENBQUNDLElBQUksR0FBRztJQUNkO0FBQ0Y7QUFFTyxNQUFNQyw0QkFBNEJMO0lBQ3ZDQyxZQUFZQyxVQUFrQixnQ0FBZ0MsQ0FBRTtRQUM5RCxLQUFLLENBQUNBO1FBQ04sSUFBSSxDQUFDRSxJQUFJLEdBQUc7SUFDZDtBQUNGO0FBRU8sTUFBTUUsMkJBQTJCTjtJQUN0Q0MsWUFBWUMsVUFBa0IsaUNBQWlDLENBQUU7UUFDL0QsS0FBSyxDQUFDQTtRQUNOLElBQUksQ0FBQ0UsSUFBSSxHQUFHO0lBQ2Q7QUFDRjtBQUVPLE1BQU1HLHNCQUFzQlA7SUFDakNDLFlBQVlDLFVBQWtCLHdCQUF3QixDQUFFO1FBQ3RELEtBQUssQ0FBQ0E7UUFDTixJQUFJLENBQUNFLElBQUksR0FBRztJQUNkO0FBQ0Y7QUFFTyxNQUFNSSxzQkFBc0JSO0lBQ2pDQyxZQUFZQyxVQUFrQixvQkFBb0IsQ0FBRTtRQUNsRCxLQUFLLENBQUNBO1FBQ04sSUFBSSxDQUFDRSxJQUFJLEdBQUc7SUFDZDtBQUNGO0FBRU8sTUFBTUssd0JBQXdCVDtJQUNuQ0MsWUFBWUMsVUFBa0IsbUJBQW1CLENBQUU7UUFDakQsS0FBSyxDQUFDQTtRQUNOLElBQUksQ0FBQ0UsSUFBSSxHQUFHO0lBQ2Q7QUFDRjtBQUVPLE1BQU1NLHVCQUF1QlY7SUFDbENDLFlBQVlDLFVBQWtCLDBDQUEwQyxDQUFFO1FBQ3hFLEtBQUssQ0FBQ0E7UUFDTixJQUFJLENBQUNFLElBQUksR0FBRztJQUNkO0FBQ0Y7QUFFTyxNQUFNTyxvQkFBb0JYO0lBQy9CQyxZQUFZQyxVQUFrQix1QkFBdUIsQ0FBRTtRQUNyRCxLQUFLLENBQUNBO1FBQ04sSUFBSSxDQUFDRSxJQUFJLEdBQUc7SUFDZDtBQUNGO0FBRU8sTUFBTVEsbUJBQW1CWjtJQUM5QkMsWUFBWUMsVUFBa0IsV0FBVyxDQUFFO1FBQ3pDLEtBQUssQ0FBQ0E7UUFDTixJQUFJLENBQUNFLElBQUksR0FBRztJQUNkO0FBQ0Y7QUFFTyxNQUFNUyw2QkFBNkJiO0lBQ3hDQyxZQUNFQyxVQUFrQixvQkFBb0IsRUFDdEMsT0FBc0IsQ0FDdEI7UUFDQSxLQUFLLENBQUNBO2FBRkNZLFVBQUFBO1FBR1AsSUFBSSxDQUFDVixJQUFJLEdBQUc7SUFDZDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZWR1Y2F0aW9uYWwtcGxhdGZvcm0vLi9zcmMvbGliL2Vycm9ycy50cz80NTFhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuXG5leHBvcnQgY2xhc3MgVmFsaWRhdGlvbkVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihcbiAgICBtZXNzYWdlOiBzdHJpbmcsXG4gICAgcHVibGljIGRldGFpbHM/OiB7XG4gICAgICBlcnJvcnM6IHouWm9kSXNzdWVbXTtcbiAgICB9XG4gICkge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubmFtZSA9ICdWYWxpZGF0aW9uRXJyb3InO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBBdXRoZW50aWNhdGlvbkVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcgPSAn2YTYt9mB2Kcg2YjYp9ix2K8g2K3Ys9in2Kgg2qnYp9ix2KjYsduMINiu2YjYryDYtNmI24zYrycpIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSAnQXV0aGVudGljYXRpb25FcnJvcic7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEF1dGhvcml6YXRpb25FcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nID0gJ9i02YXYpyDYr9iz2KrYsdiz24wg2KjZhyDYp9uM2YYg2KjYrti0INix2Kcg2YbYr9in2LHbjNivJykge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubmFtZSA9ICdBdXRob3JpemF0aW9uRXJyb3InO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBOb3RGb3VuZEVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcgPSAn2YXZiNix2K8g2K/Ysdiu2YjYp9iz2KrbjCDbjNin2YHYqiDZhti02K8nKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7XG4gICAgdGhpcy5uYW1lID0gJ05vdEZvdW5kRXJyb3InO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBEYXRhYmFzZUVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcgPSAn2K7Yt9inINiv2LEg2b7Yp9uM2q/Yp9mHINiv2KfYr9mHJykge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubmFtZSA9ICdEYXRhYmFzZUVycm9yJztcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgRmlsZVVwbG9hZEVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcgPSAn2K7Yt9inINiv2LEg2KLZvtmE2YjYryDZgdin24zZhCcpIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSAnRmlsZVVwbG9hZEVycm9yJztcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgUmF0ZUxpbWl0RXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZyA9ICfYqti52K/Yp9ivINiv2LHYrtmI2KfYs9iq4oCM2YfYp9uMINi02YXYpyDYqNuM2LQg2KfYsiDYrdivINmF2KzYp9iyINin2LPYqicpIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSAnUmF0ZUxpbWl0RXJyb3InO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBTb2NrZXRFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nID0gJ9iu2LfYpyDYr9ixINin2LHYqtio2KfYtyDYqNinINiz2LHZiNixJykge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubmFtZSA9ICdTb2NrZXRFcnJvcic7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIENhY2hlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZyA9ICfYrti32Kcg2K/YsSDaqdi0Jykge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubmFtZSA9ICdDYWNoZUVycm9yJztcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgRXh0ZXJuYWxTZXJ2aWNlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIG1lc3NhZ2U6IHN0cmluZyA9ICfYrti32Kcg2K/YsSDYs9ix2YjbjNizINiu2KfYsdis24wnLFxuICAgIHB1YmxpYyBzZXJ2aWNlOiBzdHJpbmdcbiAgKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7XG4gICAgdGhpcy5uYW1lID0gJ0V4dGVybmFsU2VydmljZUVycm9yJztcbiAgfVxufSAiXSwibmFtZXMiOlsiVmFsaWRhdGlvbkVycm9yIiwiRXJyb3IiLCJjb25zdHJ1Y3RvciIsIm1lc3NhZ2UiLCJkZXRhaWxzIiwibmFtZSIsIkF1dGhlbnRpY2F0aW9uRXJyb3IiLCJBdXRob3JpemF0aW9uRXJyb3IiLCJOb3RGb3VuZEVycm9yIiwiRGF0YWJhc2VFcnJvciIsIkZpbGVVcGxvYWRFcnJvciIsIlJhdGVMaW1pdEVycm9yIiwiU29ja2V0RXJyb3IiLCJDYWNoZUVycm9yIiwiRXh0ZXJuYWxTZXJ2aWNlRXJyb3IiLCJzZXJ2aWNlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/lib/errors.ts\n");

/***/ }),

/***/ "(api)/./src/lib/logger.ts":
/*!***************************!*\
  !*** ./src/lib/logger.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   logError: () => (/* binding */ logError),\n/* harmony export */   logRequest: () => (/* binding */ logRequest),\n/* harmony export */   logSecurityEvent: () => (/* binding */ logSecurityEvent),\n/* harmony export */   logger: () => (/* binding */ logger)\n/* harmony export */ });\n/* harmony import */ var winston__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! winston */ \"winston\");\n/* harmony import */ var winston__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(winston__WEBPACK_IMPORTED_MODULE_0__);\n\n// Log format\nconst logFormat = winston__WEBPACK_IMPORTED_MODULE_0___default().format.combine(winston__WEBPACK_IMPORTED_MODULE_0___default().format.timestamp(), winston__WEBPACK_IMPORTED_MODULE_0___default().format.errors({\n    stack: true\n}), winston__WEBPACK_IMPORTED_MODULE_0___default().format.json());\n// Create logger instance\nconst logger = winston__WEBPACK_IMPORTED_MODULE_0___default().createLogger({\n    level:  false ? 0 : \"debug\",\n    format: logFormat,\n    defaultMeta: {\n        service: \"api\"\n    },\n    transports: [\n        // Write all logs to console\n        new (winston__WEBPACK_IMPORTED_MODULE_0___default().transports).Console({\n            format: winston__WEBPACK_IMPORTED_MODULE_0___default().format.combine(winston__WEBPACK_IMPORTED_MODULE_0___default().format.colorize(), winston__WEBPACK_IMPORTED_MODULE_0___default().format.simple())\n        }),\n        // Write all logs with level 'error' and below to error.log\n        new (winston__WEBPACK_IMPORTED_MODULE_0___default().transports).File({\n            filename: \"logs/error.log\",\n            level: \"error\",\n            maxsize: 5242880,\n            maxFiles: 5\n        }),\n        // Write all logs with level 'info' and below to combined.log\n        new (winston__WEBPACK_IMPORTED_MODULE_0___default().transports).File({\n            filename: \"logs/combined.log\",\n            maxsize: 5242880,\n            maxFiles: 5\n        })\n    ]\n});\n// Request logging\nconst logRequest = (req)=>{\n    return {\n        method: req.method,\n        url: req.url,\n        query: req.query,\n        body: req.body,\n        user: req.user?.id,\n        ip: req.headers[\"x-forwarded-for\"] || req.socket.remoteAddress\n    };\n};\n// Error logging\nconst logError = (error, req)=>{\n    const errorLog = {\n        message: error.message,\n        stack: error.stack,\n        name: error.name\n    };\n    if (req) {\n        Object.assign(errorLog, logRequest(req));\n    }\n    return errorLog;\n};\nconst logSecurityEvent = (event, req, details = {})=>{\n    logger.warn({\n        message: event,\n        ...details,\n        path: req.url,\n        method: req.method,\n        ip: req.headers[\"x-forwarded-for\"] || req.socket.remoteAddress\n    });\n};\n// Export logger\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL2xvZ2dlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFDOEI7QUFHOUIsYUFBYTtBQUNiLE1BQU1DLFlBQVlELHFEQUFjLENBQUNHLE9BQU8sQ0FDdENILHFEQUFjLENBQUNJLFNBQVMsSUFDeEJKLHFEQUFjLENBQUNLLE1BQU0sQ0FBQztJQUFFQyxPQUFPO0FBQUssSUFDcENOLHFEQUFjLENBQUNPLElBQUk7QUFHckIseUJBQXlCO0FBQ3pCLE1BQU1DLFNBQVNSLDJEQUFvQixDQUFDO0lBQ2xDVSxPQUFPQyxNQUF5QixHQUFlLElBQVM7SUFDeERULFFBQVFEO0lBQ1JXLGFBQWE7UUFBRUMsU0FBUztJQUFNO0lBQzlCQyxZQUFZO1FBQ1YsNEJBQTRCO1FBQzVCLElBQUlkLDJEQUFrQixDQUFDZSxPQUFPLENBQUM7WUFDN0JiLFFBQVFGLHFEQUFjLENBQUNHLE9BQU8sQ0FDNUJILHFEQUFjLENBQUNnQixRQUFRLElBQ3ZCaEIscURBQWMsQ0FBQ2lCLE1BQU07UUFFekI7UUFDQSwyREFBMkQ7UUFDM0QsSUFBSWpCLDJEQUFrQixDQUFDa0IsSUFBSSxDQUFDO1lBQzFCQyxVQUFVO1lBQ1ZULE9BQU87WUFDUFUsU0FBUztZQUNUQyxVQUFVO1FBQ1o7UUFDQSw2REFBNkQ7UUFDN0QsSUFBSXJCLDJEQUFrQixDQUFDa0IsSUFBSSxDQUFDO1lBQzFCQyxVQUFVO1lBQ1ZDLFNBQVM7WUFDVEMsVUFBVTtRQUNaO0tBQ0Q7QUFDSDtBQUVBLGtCQUFrQjtBQUNYLE1BQU1DLGFBQWEsQ0FBQ0M7SUFDekIsT0FBTztRQUNMQyxRQUFRRCxJQUFJQyxNQUFNO1FBQ2xCQyxLQUFLRixJQUFJRSxHQUFHO1FBQ1pDLE9BQU9ILElBQUlHLEtBQUs7UUFDaEJDLE1BQU1KLElBQUlJLElBQUk7UUFDZEMsTUFBTUwsSUFBSUssSUFBSSxFQUFFQztRQUNoQkMsSUFBSVAsSUFBSVEsT0FBTyxDQUFDLGtCQUFrQixJQUFJUixJQUFJUyxNQUFNLENBQUNDLGFBQWE7SUFDaEU7QUFDRixFQUFFO0FBRUYsZ0JBQWdCO0FBQ1QsTUFBTUMsV0FBVyxDQUFDQyxPQUFjWjtJQUNyQyxNQUFNYSxXQUFXO1FBQ2ZDLFNBQVNGLE1BQU1FLE9BQU87UUFDdEIvQixPQUFPNkIsTUFBTTdCLEtBQUs7UUFDbEJnQyxNQUFNSCxNQUFNRyxJQUFJO0lBQ2xCO0lBRUEsSUFBSWYsS0FBSztRQUNQZ0IsT0FBT0MsTUFBTSxDQUFDSixVQUFVZCxXQUFXQztJQUNyQztJQUVBLE9BQU9hO0FBQ1QsRUFBRTtBQUVLLE1BQU1LLG1CQUFtQixDQUM5QkMsT0FDQW5CLEtBQ0FvQixVQUFtQyxDQUFDLENBQUM7SUFFckNuQyxPQUFPb0MsSUFBSSxDQUFDO1FBQ1ZQLFNBQVNLO1FBQ1QsR0FBR0MsT0FBTztRQUNWRSxNQUFNdEIsSUFBSUUsR0FBRztRQUNiRCxRQUFRRCxJQUFJQyxNQUFNO1FBQ2xCTSxJQUFJUCxJQUFJUSxPQUFPLENBQUMsa0JBQWtCLElBQUlSLElBQUlTLE1BQU0sQ0FBQ0MsYUFBYTtJQUNoRTtBQUNGLEVBQUU7QUFFRixnQkFBZ0I7QUFDRSIsInNvdXJjZXMiOlsid2VicGFjazovL2VkdWNhdGlvbmFsLXBsYXRmb3JtLy4vc3JjL2xpYi9sb2dnZXIudHM/YjQ5ZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCB9IGZyb20gJ25leHQnO1xuaW1wb3J0IHdpbnN0b24gZnJvbSAnd2luc3Rvbic7XG5pbXBvcnQgeyBmb3JtYXQgfSBmcm9tICd3aW5zdG9uJztcblxuLy8gTG9nIGZvcm1hdFxuY29uc3QgbG9nRm9ybWF0ID0gd2luc3Rvbi5mb3JtYXQuY29tYmluZShcbiAgd2luc3Rvbi5mb3JtYXQudGltZXN0YW1wKCksXG4gIHdpbnN0b24uZm9ybWF0LmVycm9ycyh7IHN0YWNrOiB0cnVlIH0pLFxuICB3aW5zdG9uLmZvcm1hdC5qc29uKClcbik7XG5cbi8vIENyZWF0ZSBsb2dnZXIgaW5zdGFuY2VcbmNvbnN0IGxvZ2dlciA9IHdpbnN0b24uY3JlYXRlTG9nZ2VyKHtcbiAgbGV2ZWw6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicgPyAnaW5mbycgOiAnZGVidWcnLFxuICBmb3JtYXQ6IGxvZ0Zvcm1hdCxcbiAgZGVmYXVsdE1ldGE6IHsgc2VydmljZTogJ2FwaScgfSxcbiAgdHJhbnNwb3J0czogW1xuICAgIC8vIFdyaXRlIGFsbCBsb2dzIHRvIGNvbnNvbGVcbiAgICBuZXcgd2luc3Rvbi50cmFuc3BvcnRzLkNvbnNvbGUoe1xuICAgICAgZm9ybWF0OiB3aW5zdG9uLmZvcm1hdC5jb21iaW5lKFxuICAgICAgICB3aW5zdG9uLmZvcm1hdC5jb2xvcml6ZSgpLFxuICAgICAgICB3aW5zdG9uLmZvcm1hdC5zaW1wbGUoKVxuICAgICAgKVxuICAgIH0pLFxuICAgIC8vIFdyaXRlIGFsbCBsb2dzIHdpdGggbGV2ZWwgJ2Vycm9yJyBhbmQgYmVsb3cgdG8gZXJyb3IubG9nXG4gICAgbmV3IHdpbnN0b24udHJhbnNwb3J0cy5GaWxlKHtcbiAgICAgIGZpbGVuYW1lOiAnbG9ncy9lcnJvci5sb2cnLFxuICAgICAgbGV2ZWw6ICdlcnJvcicsXG4gICAgICBtYXhzaXplOiA1MjQyODgwLCAvLyA1TUJcbiAgICAgIG1heEZpbGVzOiA1XG4gICAgfSksXG4gICAgLy8gV3JpdGUgYWxsIGxvZ3Mgd2l0aCBsZXZlbCAnaW5mbycgYW5kIGJlbG93IHRvIGNvbWJpbmVkLmxvZ1xuICAgIG5ldyB3aW5zdG9uLnRyYW5zcG9ydHMuRmlsZSh7XG4gICAgICBmaWxlbmFtZTogJ2xvZ3MvY29tYmluZWQubG9nJyxcbiAgICAgIG1heHNpemU6IDUyNDI4ODAsIC8vIDVNQlxuICAgICAgbWF4RmlsZXM6IDVcbiAgICB9KVxuICBdXG59KTtcblxuLy8gUmVxdWVzdCBsb2dnaW5nXG5leHBvcnQgY29uc3QgbG9nUmVxdWVzdCA9IChyZXE6IE5leHRBcGlSZXF1ZXN0KSA9PiB7XG4gIHJldHVybiB7XG4gICAgbWV0aG9kOiByZXEubWV0aG9kLFxuICAgIHVybDogcmVxLnVybCxcbiAgICBxdWVyeTogcmVxLnF1ZXJ5LFxuICAgIGJvZHk6IHJlcS5ib2R5LFxuICAgIHVzZXI6IHJlcS51c2VyPy5pZCxcbiAgICBpcDogcmVxLmhlYWRlcnNbJ3gtZm9yd2FyZGVkLWZvciddIHx8IHJlcS5zb2NrZXQucmVtb3RlQWRkcmVzc1xuICB9O1xufTtcblxuLy8gRXJyb3IgbG9nZ2luZ1xuZXhwb3J0IGNvbnN0IGxvZ0Vycm9yID0gKGVycm9yOiBFcnJvciwgcmVxPzogTmV4dEFwaVJlcXVlc3QpID0+IHtcbiAgY29uc3QgZXJyb3JMb2cgPSB7XG4gICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICBzdGFjazogZXJyb3Iuc3RhY2ssXG4gICAgbmFtZTogZXJyb3IubmFtZVxuICB9O1xuXG4gIGlmIChyZXEpIHtcbiAgICBPYmplY3QuYXNzaWduKGVycm9yTG9nLCBsb2dSZXF1ZXN0KHJlcSkpO1xuICB9XG5cbiAgcmV0dXJuIGVycm9yTG9nO1xufTtcblxuZXhwb3J0IGNvbnN0IGxvZ1NlY3VyaXR5RXZlbnQgPSAoXG4gIGV2ZW50OiBzdHJpbmcsXG4gIHJlcTogTmV4dEFwaVJlcXVlc3QsXG4gIGRldGFpbHM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge31cbikgPT4ge1xuICBsb2dnZXIud2Fybih7XG4gICAgbWVzc2FnZTogZXZlbnQsXG4gICAgLi4uZGV0YWlscyxcbiAgICBwYXRoOiByZXEudXJsLFxuICAgIG1ldGhvZDogcmVxLm1ldGhvZCxcbiAgICBpcDogcmVxLmhlYWRlcnNbJ3gtZm9yd2FyZGVkLWZvciddIHx8IHJlcS5zb2NrZXQucmVtb3RlQWRkcmVzc1xuICB9KTtcbn07XG5cbi8vIEV4cG9ydCBsb2dnZXJcbmV4cG9ydCB7IGxvZ2dlciB9OyAiXSwibmFtZXMiOlsid2luc3RvbiIsImxvZ0Zvcm1hdCIsImZvcm1hdCIsImNvbWJpbmUiLCJ0aW1lc3RhbXAiLCJlcnJvcnMiLCJzdGFjayIsImpzb24iLCJsb2dnZXIiLCJjcmVhdGVMb2dnZXIiLCJsZXZlbCIsInByb2Nlc3MiLCJkZWZhdWx0TWV0YSIsInNlcnZpY2UiLCJ0cmFuc3BvcnRzIiwiQ29uc29sZSIsImNvbG9yaXplIiwic2ltcGxlIiwiRmlsZSIsImZpbGVuYW1lIiwibWF4c2l6ZSIsIm1heEZpbGVzIiwibG9nUmVxdWVzdCIsInJlcSIsIm1ldGhvZCIsInVybCIsInF1ZXJ5IiwiYm9keSIsInVzZXIiLCJpZCIsImlwIiwiaGVhZGVycyIsInNvY2tldCIsInJlbW90ZUFkZHJlc3MiLCJsb2dFcnJvciIsImVycm9yIiwiZXJyb3JMb2ciLCJtZXNzYWdlIiwibmFtZSIsIk9iamVjdCIsImFzc2lnbiIsImxvZ1NlY3VyaXR5RXZlbnQiLCJldmVudCIsImRldGFpbHMiLCJ3YXJuIiwicGF0aCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/lib/logger.ts\n");

/***/ }),

/***/ "(api)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst globalForPrisma = globalThis;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\nif (true) {\n    globalForPrisma.prisma = prisma;\n}\n// Test database connection\nprisma.$connect().then(()=>{\n    console.log(\"Successfully connected to database\");\n}).catch((error)=>{\n    console.error(\"Failed to connect to database:\", error);\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL3ByaXNtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBOEM7QUFFOUMsTUFBTUMsa0JBQWtCQztBQUlqQixNQUFNQyxTQUFTRixnQkFBZ0JFLE1BQU0sSUFBSSxJQUFJSCx3REFBWUEsR0FBRztBQUVuRSxJQUFJSSxJQUF5QixFQUFjO0lBQ3pDSCxnQkFBZ0JFLE1BQU0sR0FBR0E7QUFDM0I7QUFFQSwyQkFBMkI7QUFDM0JBLE9BQU9FLFFBQVEsR0FDWkMsSUFBSSxDQUFDO0lBQ0pDLFFBQVFDLEdBQUcsQ0FBQztBQUNkLEdBQ0NDLEtBQUssQ0FBQyxDQUFDQztJQUNOSCxRQUFRRyxLQUFLLENBQUMsa0NBQWtDQTtBQUNsRCIsInNvdXJjZXMiOlsid2VicGFjazovL2VkdWNhdGlvbmFsLXBsYXRmb3JtLy4vc3JjL2xpYi9wcmlzbWEudHM/MDFkNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XG5cbmNvbnN0IGdsb2JhbEZvclByaXNtYSA9IGdsb2JhbFRoaXMgYXMgdW5rbm93biBhcyB7XG4gIHByaXNtYTogUHJpc21hQ2xpZW50IHwgdW5kZWZpbmVkO1xufTtcblxuZXhwb3J0IGNvbnN0IHByaXNtYSA9IGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPz8gbmV3IFByaXNtYUNsaWVudCgpO1xuXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xuICBnbG9iYWxGb3JQcmlzbWEucHJpc21hID0gcHJpc21hO1xufVxuXG4vLyBUZXN0IGRhdGFiYXNlIGNvbm5lY3Rpb25cbnByaXNtYS4kY29ubmVjdCgpXG4gIC50aGVuKCgpID0+IHtcbiAgICBjb25zb2xlLmxvZygnU3VjY2Vzc2Z1bGx5IGNvbm5lY3RlZCB0byBkYXRhYmFzZScpO1xuICB9KVxuICAuY2F0Y2goKGVycm9yOiBFcnJvcikgPT4ge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjb25uZWN0IHRvIGRhdGFiYXNlOicsIGVycm9yKTtcbiAgfSk7ICJdLCJuYW1lcyI6WyJQcmlzbWFDbGllbnQiLCJnbG9iYWxGb3JQcmlzbWEiLCJnbG9iYWxUaGlzIiwicHJpc21hIiwicHJvY2VzcyIsIiRjb25uZWN0IiwidGhlbiIsImNvbnNvbGUiLCJsb2ciLCJjYXRjaCIsImVycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/lib/prisma.ts\n");

/***/ }),

/***/ "(api)/./src/lib/redis.ts":
/*!**************************!*\
  !*** ./src/lib/redis.ts ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   closeRedisClient: () => (/* binding */ closeRedisClient),\n/* harmony export */   getRedisClient: () => (/* binding */ getRedisClient)\n/* harmony export */ });\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ioredis */ \"ioredis\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(ioredis__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _logger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./logger */ \"(api)/./src/lib/logger.ts\");\n\n\nlet redisClient = null;\nfunction getRedisClient() {\n    if (true) {\n        try {\n            if (!redisClient) {\n                redisClient = new ioredis__WEBPACK_IMPORTED_MODULE_0__.Redis(process.env.REDIS_URL || \"redis://localhost:6379\");\n            }\n            return redisClient;\n        } catch (e) {\n            _logger__WEBPACK_IMPORTED_MODULE_1__.logger.warn(\"Redis is not available in development, returning null.\");\n            // @ts-ignore\n            return null;\n        }\n    } else {}\n}\nasync function closeRedisClient() {\n    if (redisClient) {\n        await redisClient.quit();\n        redisClient = null;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL3JlZGlzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQWdDO0FBQ0U7QUFFbEMsSUFBSUUsY0FBNEI7QUFFekIsU0FBU0M7SUFDZCxJQUFJQyxJQUF5QixFQUFlO1FBQzFDLElBQUk7WUFDRixJQUFJLENBQUNGLGFBQWE7Z0JBQ2hCQSxjQUFjLElBQUlGLDBDQUFLQSxDQUFDSSxRQUFRQyxHQUFHLENBQUNDLFNBQVMsSUFBSTtZQUNuRDtZQUNBLE9BQU9KO1FBQ1QsRUFBRSxPQUFPSyxHQUFHO1lBQ1ZOLDJDQUFNQSxDQUFDTyxJQUFJLENBQUM7WUFDWixhQUFhO1lBQ2IsT0FBTztRQUNUO0lBQ0YsT0FBTyxFQUtOO0FBQ0g7QUFFTyxlQUFlQztJQUNwQixJQUFJUCxhQUFhO1FBQ2YsTUFBTUEsWUFBWVEsSUFBSTtRQUN0QlIsY0FBYztJQUNoQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZWR1Y2F0aW9uYWwtcGxhdGZvcm0vLi9zcmMvbGliL3JlZGlzLnRzPzkyNWQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVkaXMgfSBmcm9tICdpb3JlZGlzJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4vbG9nZ2VyJztcblxubGV0IHJlZGlzQ2xpZW50OiBSZWRpcyB8IG51bGwgPSBudWxsO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmVkaXNDbGllbnQoKTogUmVkaXMge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcbiAgICB0cnkge1xuICAgICAgaWYgKCFyZWRpc0NsaWVudCkge1xuICAgICAgICByZWRpc0NsaWVudCA9IG5ldyBSZWRpcyhwcm9jZXNzLmVudi5SRURJU19VUkwgfHwgJ3JlZGlzOi8vbG9jYWxob3N0OjYzNzknKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZWRpc0NsaWVudDtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsb2dnZXIud2FybignUmVkaXMgaXMgbm90IGF2YWlsYWJsZSBpbiBkZXZlbG9wbWVudCwgcmV0dXJuaW5nIG51bGwuJyk7XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgaWYgKCFyZWRpc0NsaWVudCkge1xuICAgICAgcmVkaXNDbGllbnQgPSBuZXcgUmVkaXMocHJvY2Vzcy5lbnYuUkVESVNfVVJMIHx8ICdyZWRpczovL2xvY2FsaG9zdDo2Mzc5Jyk7XG4gICAgfVxuICAgIHJldHVybiByZWRpc0NsaWVudDtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2xvc2VSZWRpc0NsaWVudCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgaWYgKHJlZGlzQ2xpZW50KSB7XG4gICAgYXdhaXQgcmVkaXNDbGllbnQucXVpdCgpO1xuICAgIHJlZGlzQ2xpZW50ID0gbnVsbDtcbiAgfVxufSAiXSwibmFtZXMiOlsiUmVkaXMiLCJsb2dnZXIiLCJyZWRpc0NsaWVudCIsImdldFJlZGlzQ2xpZW50IiwicHJvY2VzcyIsImVudiIsIlJFRElTX1VSTCIsImUiLCJ3YXJuIiwiY2xvc2VSZWRpc0NsaWVudCIsInF1aXQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/lib/redis.ts\n");

/***/ }),

/***/ "(api)/./src/lib/sanitize.ts":
/*!*****************************!*\
  !*** ./src/lib/sanitize.ts ***!
  \*****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   sanitizeHtml: () => (/* binding */ sanitizeHtml)\n/* harmony export */ });\n/* harmony import */ var html_escaper__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! html-escaper */ \"html-escaper\");\n/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! dompurify */ \"dompurify\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([html_escaper__WEBPACK_IMPORTED_MODULE_0__, dompurify__WEBPACK_IMPORTED_MODULE_1__]);\n([html_escaper__WEBPACK_IMPORTED_MODULE_0__, dompurify__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n// در محیط سرور، DOMPurify نیاز به window دارد\nconst purify =  false ? 0 : {\n    sanitize: (dirty)=>dirty\n};\nconst sanitizeHtml = (html)=>{\n    // First escape HTML entities\n    const escaped = (0,html_escaper__WEBPACK_IMPORTED_MODULE_0__.escape)(html);\n    // Then sanitize the HTML\n    return purify.sanitize(escaped);\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL3Nhbml0aXplLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFzQztBQUNKO0FBRWxDLDhDQUE4QztBQUM5QyxNQUFNRSxTQUFTLE1BQWtCLEdBQWNELENBQVNBLEdBQUc7SUFDekRFLFVBQVUsQ0FBQ0MsUUFBa0JBO0FBQy9CO0FBRU8sTUFBTUMsZUFBZSxDQUFDQztJQUMzQiw2QkFBNkI7SUFDN0IsTUFBTUMsVUFBVVAsb0RBQU1BLENBQUNNO0lBRXZCLHlCQUF5QjtJQUN6QixPQUFPSixPQUFPQyxRQUFRLENBQUNJO0FBQ3pCLEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9lZHVjYXRpb25hbC1wbGF0Zm9ybS8uL3NyYy9saWIvc2FuaXRpemUudHM/MDBkYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBlc2NhcGUgfSBmcm9tICdodG1sLWVzY2FwZXInO1xuaW1wb3J0IERPTVB1cmlmeSBmcm9tICdkb21wdXJpZnknO1xuXG4vLyDYr9ixINmF2K3bjNi3INiz2LHZiNix2IwgRE9NUHVyaWZ5INmG24zYp9iyINio2Ycgd2luZG93INiv2KfYsdivXG5jb25zdCBwdXJpZnkgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IERPTVB1cmlmeSA6IHtcbiAgc2FuaXRpemU6IChkaXJ0eTogc3RyaW5nKSA9PiBkaXJ0eSxcbn07XG5cbmV4cG9ydCBjb25zdCBzYW5pdGl6ZUh0bWwgPSAoaHRtbDogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgLy8gRmlyc3QgZXNjYXBlIEhUTUwgZW50aXRpZXNcbiAgY29uc3QgZXNjYXBlZCA9IGVzY2FwZShodG1sKTtcbiAgXG4gIC8vIFRoZW4gc2FuaXRpemUgdGhlIEhUTUxcbiAgcmV0dXJuIHB1cmlmeS5zYW5pdGl6ZShlc2NhcGVkKTtcbn07ICJdLCJuYW1lcyI6WyJlc2NhcGUiLCJET01QdXJpZnkiLCJwdXJpZnkiLCJzYW5pdGl6ZSIsImRpcnR5Iiwic2FuaXRpemVIdG1sIiwiaHRtbCIsImVzY2FwZWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/lib/sanitize.ts\n");

/***/ }),

/***/ "(api)/./src/middleware/auth.ts":
/*!********************************!*\
  !*** ./src/middleware/auth.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   withAdmin: () => (/* binding */ withAdmin),\n/* harmony export */   withAuth: () => (/* binding */ withAuth),\n/* harmony export */   withInstructor: () => (/* binding */ withInstructor),\n/* harmony export */   withOptionalAuth: () => (/* binding */ withOptionalAuth),\n/* harmony export */   withUser: () => (/* binding */ withUser)\n/* harmony export */ });\n/* harmony import */ var next_auth_react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/react */ \"next-auth/react\");\n/* harmony import */ var next_auth_react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth_react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/logger */ \"(api)/./src/lib/logger.ts\");\n\n\n// Default configuration\nconst defaultConfig = {\n    required: true,\n    roles: [],\n    message: \"لطفا وارد حساب کاربری خود شوید\"\n};\n// Auth middleware\nconst withAuth = (handler, config = {})=>{\n    const finalConfig = {\n        ...defaultConfig,\n        ...config\n    };\n    return async (req, res)=>{\n        try {\n            const session = await (0,next_auth_react__WEBPACK_IMPORTED_MODULE_0__.getSession)({\n                req\n            });\n            // Check if authentication is required\n            if (finalConfig.required && !session) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.warn(\"Authentication required\", {\n                    path: req.url,\n                    method: req.method\n                });\n                return res.status(401).json({\n                    success: false,\n                    error: {\n                        message: finalConfig.message || \"لطفا وارد حساب کاربری خود شوید\",\n                        code: \"UNAUTHORIZED\"\n                    }\n                });\n            }\n            // Check role-based authorization\n            if (finalConfig.roles && finalConfig.roles.length > 0) {\n                const userRole = session?.user?.role;\n                if (!userRole || !finalConfig.roles.includes(userRole)) {\n                    _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.warn(\"Authorization failed\", {\n                        path: req.url,\n                        method: req.method,\n                        userRole,\n                        requiredRoles: finalConfig.roles\n                    });\n                    return res.status(403).json({\n                        success: false,\n                        error: {\n                            message: \"شما دسترسی به این عملیات را ندارید\",\n                            code: \"FORBIDDEN\"\n                        }\n                    });\n                }\n            }\n            // Add user to request object\n            req.user = session?.user;\n            return handler(req, res);\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.error(\"Auth middleware error\", error);\n            return res.status(500).json({\n                success: false,\n                error: {\n                    message: \"خطا در بررسی احراز هویت\",\n                    code: \"INTERNAL_SERVER_ERROR\"\n                }\n            });\n        }\n    };\n};\n// Role-based middleware helpers\nconst withAdmin = (handler)=>withAuth(handler, {\n        roles: [\n            \"ADMIN\"\n        ]\n    });\nconst withInstructor = (handler)=>withAuth(handler, {\n        roles: [\n            \"INSTRUCTOR\"\n        ]\n    });\nconst withUser = (handler)=>withAuth(handler, {\n        roles: [\n            \"USER\"\n        ]\n    });\nconst withOptionalAuth = (handler)=>withAuth(handler, {\n        required: false\n    });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbWlkZGxld2FyZS9hdXRoLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQzZDO0FBR1A7QUFXdEMsd0JBQXdCO0FBQ3hCLE1BQU1FLGdCQUE0QjtJQUNoQ0MsVUFBVTtJQUNWQyxPQUFPLEVBQUU7SUFDVEMsU0FBUztBQUNYO0FBRUEsa0JBQWtCO0FBQ1gsTUFBTUMsV0FBVyxDQUFJQyxTQUFtR0MsU0FBOEIsQ0FBQyxDQUFDO0lBQzdKLE1BQU1DLGNBQWM7UUFBRSxHQUFHUCxhQUFhO1FBQUUsR0FBR00sTUFBTTtJQUFDO0lBRWxELE9BQU8sT0FBT0UsS0FBcUJDO1FBQ2pDLElBQUk7WUFDRixNQUFNQyxVQUFVLE1BQU1aLDJEQUFVQSxDQUFDO2dCQUFFVTtZQUFJO1lBRXZDLHNDQUFzQztZQUN0QyxJQUFJRCxZQUFZTixRQUFRLElBQUksQ0FBQ1MsU0FBUztnQkFDcENYLCtDQUFNQSxDQUFDWSxJQUFJLENBQUMsMkJBQTJCO29CQUNyQ0MsTUFBTUosSUFBSUssR0FBRztvQkFDYkMsUUFBUU4sSUFBSU0sTUFBTTtnQkFDcEI7Z0JBRUEsT0FBT0wsSUFBSU0sTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztvQkFDMUJDLFNBQVM7b0JBQ1RDLE9BQU87d0JBQ0xmLFNBQVNJLFlBQVlKLE9BQU8sSUFBSTt3QkFDaENnQixNQUFNO29CQUNSO2dCQUNGO1lBQ0Y7WUFFQSxpQ0FBaUM7WUFDakMsSUFBSVosWUFBWUwsS0FBSyxJQUFJSyxZQUFZTCxLQUFLLENBQUNrQixNQUFNLEdBQUcsR0FBRztnQkFDckQsTUFBTUMsV0FBV1gsU0FBU1ksTUFBTUM7Z0JBRWhDLElBQUksQ0FBQ0YsWUFBWSxDQUFDZCxZQUFZTCxLQUFLLENBQUNzQixRQUFRLENBQUNILFdBQVc7b0JBQ3REdEIsK0NBQU1BLENBQUNZLElBQUksQ0FBQyx3QkFBd0I7d0JBQ2xDQyxNQUFNSixJQUFJSyxHQUFHO3dCQUNiQyxRQUFRTixJQUFJTSxNQUFNO3dCQUNsQk87d0JBQ0FJLGVBQWVsQixZQUFZTCxLQUFLO29CQUNsQztvQkFFQSxPQUFPTyxJQUFJTSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO3dCQUMxQkMsU0FBUzt3QkFDVEMsT0FBTzs0QkFDTGYsU0FBUzs0QkFDVGdCLE1BQU07d0JBQ1I7b0JBQ0Y7Z0JBQ0Y7WUFDRjtZQUVBLDZCQUE2QjtZQUM1QlgsSUFBWWMsSUFBSSxHQUFHWixTQUFTWTtZQUU3QixPQUFPakIsUUFBUUcsS0FBS0M7UUFDdEIsRUFBRSxPQUFPUyxPQUFPO1lBQ2RuQiwrQ0FBTUEsQ0FBQ21CLEtBQUssQ0FBQyx5QkFBeUJBO1lBQ3RDLE9BQU9ULElBQUlNLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQzFCQyxTQUFTO2dCQUNUQyxPQUFPO29CQUNMZixTQUFTO29CQUNUZ0IsTUFBTTtnQkFDUjtZQUNGO1FBQ0Y7SUFDRjtBQUNGLEVBQUU7QUFFRixnQ0FBZ0M7QUFDekIsTUFBTU8sWUFBWSxDQUFDckIsVUFBaUJELFNBQVNDLFNBQVM7UUFBRUgsT0FBTztZQUFDO1NBQVE7SUFBQyxHQUFHO0FBQzVFLE1BQU15QixpQkFBaUIsQ0FBQ3RCLFVBQWlCRCxTQUFTQyxTQUFTO1FBQUVILE9BQU87WUFBQztTQUFhO0lBQUMsR0FBRztBQUN0RixNQUFNMEIsV0FBVyxDQUFDdkIsVUFBaUJELFNBQVNDLFNBQVM7UUFBRUgsT0FBTztZQUFDO1NBQU87SUFBQyxHQUFHO0FBQzFFLE1BQU0yQixtQkFBbUIsQ0FBQ3hCLFVBQWlCRCxTQUFTQyxTQUFTO1FBQUVKLFVBQVU7SUFBTSxHQUFHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZWR1Y2F0aW9uYWwtcGxhdGZvcm0vLi9zcmMvbWlkZGxld2FyZS9hdXRoLnRzP2I5YWQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xyXG5pbXBvcnQgeyBnZXRTZXNzaW9uIH0gZnJvbSAnbmV4dC1hdXRoL3JlYWN0JztcclxuaW1wb3J0IHsgQXBpUmVzcG9uc2UgfSBmcm9tICdAL3R5cGVzL2FwaSc7XHJcbmltcG9ydCB7IEF1dGhlbnRpY2F0aW9uRXJyb3IsIEF1dGhvcml6YXRpb25FcnJvciB9IGZyb20gJ0AvbGliL2Vycm9ycyc7XHJcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJ0AvbGliL2xvZ2dlcic7XHJcblxyXG50eXBlIFJvbGUgPSAnVVNFUicgfCAnQURNSU4nIHwgJ0lOU1RSVUNUT1InO1xyXG5cclxuLy8gQXV0aCBtaWRkbGV3YXJlIGNvbmZpZ3VyYXRpb25cclxuaW50ZXJmYWNlIEF1dGhDb25maWcge1xyXG4gIHJlcXVpcmVkPzogYm9vbGVhbjtcclxuICByb2xlcz86IFJvbGVbXTtcclxuICBtZXNzYWdlPzogc3RyaW5nO1xyXG59XHJcblxyXG4vLyBEZWZhdWx0IGNvbmZpZ3VyYXRpb25cclxuY29uc3QgZGVmYXVsdENvbmZpZzogQXV0aENvbmZpZyA9IHtcclxuICByZXF1aXJlZDogdHJ1ZSxcclxuICByb2xlczogW10sXHJcbiAgbWVzc2FnZTogJ9mE2LfZgdinINmI2KfYsdivINit2LPYp9ioINqp2KfYsdio2LHbjCDYrtmI2K8g2LTZiNuM2K8nXHJcbn07XHJcblxyXG4vLyBBdXRoIG1pZGRsZXdhcmVcclxuZXhwb3J0IGNvbnN0IHdpdGhBdXRoID0gPFQ+KGhhbmRsZXI6IChyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZTxBcGlSZXNwb25zZTxUPj4sIHVzZXI/OiBhbnkpID0+IFByb21pc2U8dm9pZD4sIGNvbmZpZzogUGFydGlhbDxBdXRoQ29uZmlnPiA9IHt9KSA9PiB7XHJcbiAgY29uc3QgZmluYWxDb25maWcgPSB7IC4uLmRlZmF1bHRDb25maWcsIC4uLmNvbmZpZyB9O1xyXG5cclxuICByZXR1cm4gYXN5bmMgKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlPEFwaVJlc3BvbnNlPFQ+PikgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlc3Npb24oeyByZXEgfSk7XHJcblxyXG4gICAgICAvLyBDaGVjayBpZiBhdXRoZW50aWNhdGlvbiBpcyByZXF1aXJlZFxyXG4gICAgICBpZiAoZmluYWxDb25maWcucmVxdWlyZWQgJiYgIXNlc3Npb24pIHtcclxuICAgICAgICBsb2dnZXIud2FybignQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLCB7XHJcbiAgICAgICAgICBwYXRoOiByZXEudXJsLFxyXG4gICAgICAgICAgbWV0aG9kOiByZXEubWV0aG9kXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiB7XHJcbiAgICAgICAgICAgIG1lc3NhZ2U6IGZpbmFsQ29uZmlnLm1lc3NhZ2UgfHwgJ9mE2LfZgdinINmI2KfYsdivINit2LPYp9ioINqp2KfYsdio2LHbjCDYrtmI2K8g2LTZiNuM2K8nLFxyXG4gICAgICAgICAgICBjb2RlOiAnVU5BVVRIT1JJWkVEJ1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBDaGVjayByb2xlLWJhc2VkIGF1dGhvcml6YXRpb25cclxuICAgICAgaWYgKGZpbmFsQ29uZmlnLnJvbGVzICYmIGZpbmFsQ29uZmlnLnJvbGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zdCB1c2VyUm9sZSA9IHNlc3Npb24/LnVzZXI/LnJvbGUgYXMgUm9sZTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoIXVzZXJSb2xlIHx8ICFmaW5hbENvbmZpZy5yb2xlcy5pbmNsdWRlcyh1c2VyUm9sZSkpIHtcclxuICAgICAgICAgIGxvZ2dlci53YXJuKCdBdXRob3JpemF0aW9uIGZhaWxlZCcsIHtcclxuICAgICAgICAgICAgcGF0aDogcmVxLnVybCxcclxuICAgICAgICAgICAgbWV0aG9kOiByZXEubWV0aG9kLFxyXG4gICAgICAgICAgICB1c2VyUm9sZSxcclxuICAgICAgICAgICAgcmVxdWlyZWRSb2xlczogZmluYWxDb25maWcucm9sZXNcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBlcnJvcjoge1xyXG4gICAgICAgICAgICAgIG1lc3NhZ2U6ICfYtNmF2Kcg2K/Ys9iq2LHYs9uMINio2Ycg2KfbjNmGINi52YXZhNuM2KfYqiDYsdinINmG2K/Yp9ix24zYrycsXHJcbiAgICAgICAgICAgICAgY29kZTogJ0ZPUkJJRERFTidcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBBZGQgdXNlciB0byByZXF1ZXN0IG9iamVjdFxyXG4gICAgICAocmVxIGFzIGFueSkudXNlciA9IHNlc3Npb24/LnVzZXI7XHJcblxyXG4gICAgICByZXR1cm4gaGFuZGxlcihyZXEsIHJlcyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ0F1dGggbWlkZGxld2FyZSBlcnJvcicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjoge1xyXG4gICAgICAgICAgbWVzc2FnZTogJ9iu2LfYpyDYr9ixINio2LHYsdiz24wg2KfYrdix2KfYsiDZh9mI24zYqicsXHJcbiAgICAgICAgICBjb2RlOiAnSU5URVJOQUxfU0VSVkVSX0VSUk9SJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxufTtcclxuXHJcbi8vIFJvbGUtYmFzZWQgbWlkZGxld2FyZSBoZWxwZXJzXHJcbmV4cG9ydCBjb25zdCB3aXRoQWRtaW4gPSAoaGFuZGxlcjogYW55KSA9PiB3aXRoQXV0aChoYW5kbGVyLCB7IHJvbGVzOiBbJ0FETUlOJ10gfSk7XHJcbmV4cG9ydCBjb25zdCB3aXRoSW5zdHJ1Y3RvciA9IChoYW5kbGVyOiBhbnkpID0+IHdpdGhBdXRoKGhhbmRsZXIsIHsgcm9sZXM6IFsnSU5TVFJVQ1RPUiddIH0pO1xyXG5leHBvcnQgY29uc3Qgd2l0aFVzZXIgPSAoaGFuZGxlcjogYW55KSA9PiB3aXRoQXV0aChoYW5kbGVyLCB7IHJvbGVzOiBbJ1VTRVInXSB9KTtcclxuZXhwb3J0IGNvbnN0IHdpdGhPcHRpb25hbEF1dGggPSAoaGFuZGxlcjogYW55KSA9PiB3aXRoQXV0aChoYW5kbGVyLCB7IHJlcXVpcmVkOiBmYWxzZSB9KTsgIl0sIm5hbWVzIjpbImdldFNlc3Npb24iLCJsb2dnZXIiLCJkZWZhdWx0Q29uZmlnIiwicmVxdWlyZWQiLCJyb2xlcyIsIm1lc3NhZ2UiLCJ3aXRoQXV0aCIsImhhbmRsZXIiLCJjb25maWciLCJmaW5hbENvbmZpZyIsInJlcSIsInJlcyIsInNlc3Npb24iLCJ3YXJuIiwicGF0aCIsInVybCIsIm1ldGhvZCIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwiZXJyb3IiLCJjb2RlIiwibGVuZ3RoIiwidXNlclJvbGUiLCJ1c2VyIiwicm9sZSIsImluY2x1ZGVzIiwicmVxdWlyZWRSb2xlcyIsIndpdGhBZG1pbiIsIndpdGhJbnN0cnVjdG9yIiwid2l0aFVzZXIiLCJ3aXRoT3B0aW9uYWxBdXRoIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/middleware/auth.ts\n");

/***/ }),

/***/ "(api)/./src/middleware/error.ts":
/*!*********************************!*\
  !*** ./src/middleware/error.ts ***!
  \*********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AppError: () => (/* binding */ AppError),\n/* harmony export */   errorHandler: () => (/* binding */ errorHandler),\n/* harmony export */   handleError: () => (/* binding */ handleError),\n/* harmony export */   withErrorHandler: () => (/* binding */ withErrorHandler)\n/* harmony export */ });\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/logger */ \"(api)/./src/lib/logger.ts\");\n/* harmony import */ var _lib_errors__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/errors */ \"(api)/./src/lib/errors.ts\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! zod */ \"zod\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([zod__WEBPACK_IMPORTED_MODULE_2__]);\nzod__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\nconst errorHandler = (err, req, res, next)=>{\n    _lib_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Error in request handler\", err, req);\n    const errorResponse = (statusCode, response)=>{\n        return res.status(statusCode).json(response);\n    };\n    if (err instanceof zod__WEBPACK_IMPORTED_MODULE_2__.ZodError) {\n        return errorResponse(400, {\n            success: false,\n            error: {\n                message: \"داده‌های نامعتبر\",\n                code: \"VALIDATION_ERROR\",\n                details: err.errors.map((e)=>({\n                        field: e.path.join(\".\"),\n                        message: e.message\n                    }))\n            }\n        });\n    }\n    if (err instanceof _lib_errors__WEBPACK_IMPORTED_MODULE_1__.ValidationError) {\n        return errorResponse(400, {\n            success: false,\n            error: {\n                message: err.message,\n                code: \"VALIDATION_ERROR\",\n                details: err.details?.errors.map((e)=>({\n                        field: e.path.join(\".\"),\n                        message: e.message\n                    })) || []\n            }\n        });\n    }\n    if (err instanceof _lib_errors__WEBPACK_IMPORTED_MODULE_1__.AuthenticationError) {\n        return errorResponse(401, {\n            success: false,\n            error: {\n                message: err.message,\n                code: \"UNAUTHORIZED\"\n            }\n        });\n    }\n    if (err instanceof _lib_errors__WEBPACK_IMPORTED_MODULE_1__.AuthorizationError) {\n        return errorResponse(403, {\n            success: false,\n            error: {\n                message: err.message,\n                code: \"FORBIDDEN\"\n            }\n        });\n    }\n    if (err instanceof _lib_errors__WEBPACK_IMPORTED_MODULE_1__.NotFoundError) {\n        return errorResponse(404, {\n            success: false,\n            error: {\n                message: err.message,\n                code: \"NOT_FOUND\"\n            }\n        });\n    }\n    if (err instanceof _lib_errors__WEBPACK_IMPORTED_MODULE_1__.DatabaseError || err instanceof _lib_errors__WEBPACK_IMPORTED_MODULE_1__.FileUploadError || err instanceof _lib_errors__WEBPACK_IMPORTED_MODULE_1__.RateLimitError || err instanceof _lib_errors__WEBPACK_IMPORTED_MODULE_1__.SocketError || err instanceof _lib_errors__WEBPACK_IMPORTED_MODULE_1__.CacheError || err instanceof _lib_errors__WEBPACK_IMPORTED_MODULE_1__.ExternalServiceError) {\n        return errorResponse(500, {\n            success: false,\n            error: {\n                message: err.message,\n                code: \"INTERNAL_SERVER_ERROR\",\n                details: err instanceof _lib_errors__WEBPACK_IMPORTED_MODULE_1__.ExternalServiceError ? {\n                    service: err.service\n                } : undefined\n            }\n        });\n    }\n    return errorResponse(500, {\n        success: false,\n        error: {\n            message: err instanceof Error ? err.message : \"خطای سرور\",\n            code: \"INTERNAL_SERVER_ERROR\"\n        }\n    });\n};\nclass AppError extends Error {\n    constructor(message, statusCode = 500, code = \"INTERNAL_SERVER_ERROR\"){\n        super(message);\n        this.message = message;\n        this.statusCode = statusCode;\n        this.code = code;\n        this.name = \"AppError\";\n        Error.captureStackTrace(this, this.constructor);\n    }\n}\nconst handleError = (error)=>{\n    if (error instanceof AppError) {\n        return {\n            success: false,\n            error: {\n                message: error.message,\n                code: error.code\n            }\n        };\n    }\n    if (error instanceof _lib_errors__WEBPACK_IMPORTED_MODULE_1__.ValidationError) {\n        return {\n            success: false,\n            error: {\n                message: error.message,\n                code: \"VALIDATION_ERROR\",\n                details: error.details?.errors\n            }\n        };\n    }\n    if (error instanceof zod__WEBPACK_IMPORTED_MODULE_2__.ZodError) {\n        return {\n            success: false,\n            error: {\n                message: \"داده‌های نامعتبر\",\n                code: \"VALIDATION_ERROR\",\n                details: error.errors\n            }\n        };\n    }\n    console.error(\"Unhandled Error:\", error);\n    return {\n        success: false,\n        error: {\n            message: \"خطای سرور\",\n            code: \"INTERNAL_SERVER_ERROR\"\n        }\n    };\n};\nconst withErrorHandler = (handler)=>{\n    return async (req, res)=>{\n        try {\n            await handler(req, res);\n        } catch (error) {\n            errorHandler(error, req, res, ()=>{});\n        }\n    };\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LENBQUN2QjtJQUMxQixJQUFJQSxpQkFBaUJtQixVQUFVO1FBQzdCLE9BQU87WUFDTGIsU0FBUztZQUNUTixPQUFPO2dCQUNMTyxTQUFTUCxNQUFNTyxPQUFPO2dCQUN0QkMsTUFBTVIsTUFBTVEsSUFBSTtZQUNsQjtRQUNGO0lBQ0Y7SUFFQSxJQUFJUixpQkFBaUJoQix3REFBZUEsRUFBRTtRQUNwQyxPQUFPO1lBQ0xzQixTQUFTO1lBQ1ROLE9BQU87Z0JBQ0xPLFNBQVNQLE1BQU1PLE9BQU87Z0JBQ3RCQyxNQUFNO2dCQUNOQyxTQUFTVCxNQUFNUyxPQUFPLEVBQUVDO1lBQzFCO1FBQ0Y7SUFDRjtJQUVBLElBQUlWLGlCQUFpQk4seUNBQVFBLEVBQUU7UUFDN0IsT0FBTztZQUNMWSxTQUFTO1lBQ1ROLE9BQU87Z0JBQ0xPLFNBQVM7Z0JBQ1RDLE1BQU07Z0JBQ05DLFNBQVNULE1BQU1VLE1BQU07WUFDdkI7UUFDRjtJQUNGO0lBRUFjLFFBQVF4QixLQUFLLENBQUMsb0JBQW9CQTtJQUNsQyxPQUFPO1FBQ0xNLFNBQVM7UUFDVE4sT0FBTztZQUNMTyxTQUFTO1lBQ1RDLE1BQU07UUFDUjtJQUNGO0FBQ0YsRUFBRTtBQUVLLE1BQU1pQixtQkFBbUIsQ0FDOUJDO0lBRUEsT0FBTyxPQUFPN0IsS0FBcUJDO1FBQ2pDLElBQUk7WUFDRixNQUFNNEIsUUFBUTdCLEtBQUtDO1FBQ3JCLEVBQUUsT0FBT0UsT0FBTztZQUNkTCxhQUFhSyxPQUFnQkgsS0FBS0MsS0FBSyxLQUFPO1FBQ2hEO0lBQ0Y7QUFDRixFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZWR1Y2F0aW9uYWwtcGxhdGZvcm0vLi9zcmMvbWlkZGxld2FyZS9lcnJvci50cz9jZDBjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xyXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAL2xpYi9sb2dnZXInO1xyXG5pbXBvcnQgeyBcclxuICBWYWxpZGF0aW9uRXJyb3IsXHJcbiAgQXV0aGVudGljYXRpb25FcnJvcixcclxuICBBdXRob3JpemF0aW9uRXJyb3IsXHJcbiAgTm90Rm91bmRFcnJvcixcclxuICBEYXRhYmFzZUVycm9yLFxyXG4gIEZpbGVVcGxvYWRFcnJvcixcclxuICBSYXRlTGltaXRFcnJvcixcclxuICBTb2NrZXRFcnJvcixcclxuICBDYWNoZUVycm9yLFxyXG4gIEV4dGVybmFsU2VydmljZUVycm9yXHJcbn0gZnJvbSAnQC9saWIvZXJyb3JzJztcclxuaW1wb3J0IHR5cGUgeyBBcGlSZXNwb25zZSwgRXJyb3JNaWRkbGV3YXJlLCBFcnJvclJlc3BvbnNlLCBFcnJvckNvZGUgfSBmcm9tICdAL3R5cGVzL2FwaSc7XHJcbmltcG9ydCB7IFpvZEVycm9yIH0gZnJvbSAnem9kJztcclxuaW1wb3J0IHsgY3JlYXRlRXJyb3JSZXNwb25zZSB9IGZyb20gJ0AvbGliL2FwaVJlc3BvbnNlJztcclxuXHJcbmV4cG9ydCBjb25zdCBlcnJvckhhbmRsZXIgPSAoXHJcbiAgZXJyOiB1bmtub3duLFxyXG4gIHJlcTogTmV4dEFwaVJlcXVlc3QsXHJcbiAgcmVzOiBOZXh0QXBpUmVzcG9uc2UsXHJcbiAgbmV4dDogKGVycj86IHVua25vd24pID0+IHZvaWRcclxuKSA9PiB7XHJcbiAgbG9nZ2VyLmVycm9yKCdFcnJvciBpbiByZXF1ZXN0IGhhbmRsZXInLCBlcnIsIHJlcSk7XHJcblxyXG4gIGNvbnN0IGVycm9yUmVzcG9uc2UgPSAoc3RhdHVzQ29kZTogbnVtYmVyLCByZXNwb25zZTogRXJyb3JSZXNwb25zZSkgPT4ge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoc3RhdHVzQ29kZSkuanNvbihyZXNwb25zZSk7XHJcbiAgfTtcclxuXHJcbiAgaWYgKGVyciBpbnN0YW5jZW9mIFpvZEVycm9yKSB7XHJcbiAgICByZXR1cm4gZXJyb3JSZXNwb25zZSg0MDAsIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiB7XHJcbiAgICAgICAgbWVzc2FnZTogJ9iv2KfYr9mH4oCM2YfYp9uMINmG2KfZhdi52KrYqNixJyxcclxuICAgICAgICBjb2RlOiAnVkFMSURBVElPTl9FUlJPUicsXHJcbiAgICAgICAgZGV0YWlsczogZXJyLmVycm9ycy5tYXAoZSA9PiAoe1xyXG4gICAgICAgICAgZmllbGQ6IGUucGF0aC5qb2luKCcuJyksXHJcbiAgICAgICAgICBtZXNzYWdlOiBlLm1lc3NhZ2VcclxuICAgICAgICB9KSlcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBpZiAoZXJyIGluc3RhbmNlb2YgVmFsaWRhdGlvbkVycm9yKSB7XHJcbiAgICByZXR1cm4gZXJyb3JSZXNwb25zZSg0MDAsIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiB7XHJcbiAgICAgICAgbWVzc2FnZTogZXJyLm1lc3NhZ2UsXHJcbiAgICAgICAgY29kZTogJ1ZBTElEQVRJT05fRVJST1InLFxyXG4gICAgICAgIGRldGFpbHM6IGVyci5kZXRhaWxzPy5lcnJvcnMubWFwKGUgPT4gKHtcclxuICAgICAgICAgIGZpZWxkOiBlLnBhdGguam9pbignLicpLFxyXG4gICAgICAgICAgbWVzc2FnZTogZS5tZXNzYWdlXHJcbiAgICAgICAgfSkpIHx8IFtdXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgaWYgKGVyciBpbnN0YW5jZW9mIEF1dGhlbnRpY2F0aW9uRXJyb3IpIHtcclxuICAgIHJldHVybiBlcnJvclJlc3BvbnNlKDQwMSwge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IHtcclxuICAgICAgICBtZXNzYWdlOiBlcnIubWVzc2FnZSxcclxuICAgICAgICBjb2RlOiAnVU5BVVRIT1JJWkVEJ1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGlmIChlcnIgaW5zdGFuY2VvZiBBdXRob3JpemF0aW9uRXJyb3IpIHtcclxuICAgIHJldHVybiBlcnJvclJlc3BvbnNlKDQwMywge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IHtcclxuICAgICAgICBtZXNzYWdlOiBlcnIubWVzc2FnZSxcclxuICAgICAgICBjb2RlOiAnRk9SQklEREVOJ1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGlmIChlcnIgaW5zdGFuY2VvZiBOb3RGb3VuZEVycm9yKSB7XHJcbiAgICByZXR1cm4gZXJyb3JSZXNwb25zZSg0MDQsIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiB7XHJcbiAgICAgICAgbWVzc2FnZTogZXJyLm1lc3NhZ2UsXHJcbiAgICAgICAgY29kZTogJ05PVF9GT1VORCdcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBpZiAoZXJyIGluc3RhbmNlb2YgRGF0YWJhc2VFcnJvciB8fCBcclxuICAgICAgZXJyIGluc3RhbmNlb2YgRmlsZVVwbG9hZEVycm9yIHx8IFxyXG4gICAgICBlcnIgaW5zdGFuY2VvZiBSYXRlTGltaXRFcnJvciB8fCBcclxuICAgICAgZXJyIGluc3RhbmNlb2YgU29ja2V0RXJyb3IgfHwgXHJcbiAgICAgIGVyciBpbnN0YW5jZW9mIENhY2hlRXJyb3IgfHwgXHJcbiAgICAgIGVyciBpbnN0YW5jZW9mIEV4dGVybmFsU2VydmljZUVycm9yKSB7XHJcbiAgICByZXR1cm4gZXJyb3JSZXNwb25zZSg1MDAsIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiB7XHJcbiAgICAgICAgbWVzc2FnZTogZXJyLm1lc3NhZ2UsXHJcbiAgICAgICAgY29kZTogJ0lOVEVSTkFMX1NFUlZFUl9FUlJPUicsXHJcbiAgICAgICAgZGV0YWlsczogZXJyIGluc3RhbmNlb2YgRXh0ZXJuYWxTZXJ2aWNlRXJyb3IgPyB7IHNlcnZpY2U6IGVyci5zZXJ2aWNlIH0gOiB1bmRlZmluZWRcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gZXJyb3JSZXNwb25zZSg1MDAsIHtcclxuICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgZXJyb3I6IHtcclxuICAgICAgbWVzc2FnZTogZXJyIGluc3RhbmNlb2YgRXJyb3IgPyBlcnIubWVzc2FnZSA6ICfYrti32KfbjCDYs9ix2YjYsScsXHJcbiAgICAgIGNvZGU6ICdJTlRFUk5BTF9TRVJWRVJfRVJST1InXHJcbiAgICB9XHJcbiAgfSk7XHJcbn07XHJcblxyXG5leHBvcnQgY2xhc3MgQXBwRXJyb3IgZXh0ZW5kcyBFcnJvciB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwdWJsaWMgbWVzc2FnZTogc3RyaW5nLFxyXG4gICAgcHVibGljIHN0YXR1c0NvZGU6IG51bWJlciA9IDUwMCxcclxuICAgIHB1YmxpYyBjb2RlOiBFcnJvckNvZGUgPSAnSU5URVJOQUxfU0VSVkVSX0VSUk9SJ1xyXG4gICkge1xyXG4gICAgc3VwZXIobWVzc2FnZSk7XHJcbiAgICB0aGlzLm5hbWUgPSAnQXBwRXJyb3InO1xyXG4gICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgdGhpcy5jb25zdHJ1Y3Rvcik7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgaGFuZGxlRXJyb3IgPSAoZXJyb3I6IHVua25vd24pOiBBcGlSZXNwb25zZSA9PiB7XHJcbiAgaWYgKGVycm9yIGluc3RhbmNlb2YgQXBwRXJyb3IpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjoge1xyXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgICAgY29kZTogZXJyb3IuY29kZVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgaWYgKGVycm9yIGluc3RhbmNlb2YgVmFsaWRhdGlvbkVycm9yKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IHtcclxuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgICAgIGNvZGU6ICdWQUxJREFUSU9OX0VSUk9SJyxcclxuICAgICAgICBkZXRhaWxzOiBlcnJvci5kZXRhaWxzPy5lcnJvcnNcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGlmIChlcnJvciBpbnN0YW5jZW9mIFpvZEVycm9yKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IHtcclxuICAgICAgICBtZXNzYWdlOiAn2K/Yp9iv2YfigIzZh9in24wg2YbYp9mF2LnYqtio2LEnLFxyXG4gICAgICAgIGNvZGU6ICdWQUxJREFUSU9OX0VSUk9SJyxcclxuICAgICAgICBkZXRhaWxzOiBlcnJvci5lcnJvcnNcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGNvbnNvbGUuZXJyb3IoJ1VuaGFuZGxlZCBFcnJvcjonLCBlcnJvcik7XHJcbiAgcmV0dXJuIHtcclxuICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgZXJyb3I6IHtcclxuICAgICAgbWVzc2FnZTogJ9iu2LfYp9uMINiz2LHZiNixJyxcclxuICAgICAgY29kZTogJ0lOVEVSTkFMX1NFUlZFUl9FUlJPUidcclxuICAgIH1cclxuICB9O1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IHdpdGhFcnJvckhhbmRsZXIgPSAoXHJcbiAgaGFuZGxlcjogKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSA9PiBQcm9taXNlPHZvaWQ+XHJcbikgPT4ge1xyXG4gIHJldHVybiBhc3luYyAocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGF3YWl0IGhhbmRsZXIocmVxLCByZXMpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgZXJyb3JIYW5kbGVyKGVycm9yIGFzIEVycm9yLCByZXEsIHJlcywgKCkgPT4ge30pO1xyXG4gICAgfVxyXG4gIH07XHJcbn07ICJdLCJuYW1lcyI6WyJsb2dnZXIiLCJWYWxpZGF0aW9uRXJyb3IiLCJBdXRoZW50aWNhdGlvbkVycm9yIiwiQXV0aG9yaXphdGlvbkVycm9yIiwiTm90Rm91bmRFcnJvciIsIkRhdGFiYXNlRXJyb3IiLCJGaWxlVXBsb2FkRXJyb3IiLCJSYXRlTGltaXRFcnJvciIsIlNvY2tldEVycm9yIiwiQ2FjaGVFcnJvciIsIkV4dGVybmFsU2VydmljZUVycm9yIiwiWm9kRXJyb3IiLCJlcnJvckhhbmRsZXIiLCJlcnIiLCJyZXEiLCJyZXMiLCJuZXh0IiwiZXJyb3IiLCJlcnJvclJlc3BvbnNlIiwic3RhdHVzQ29kZSIsInJlc3BvbnNlIiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwiY29kZSIsImRldGFpbHMiLCJlcnJvcnMiLCJtYXAiLCJlIiwiZmllbGQiLCJwYXRoIiwiam9pbiIsInNlcnZpY2UiLCJ1bmRlZmluZWQiLCJFcnJvciIsIkFwcEVycm9yIiwiY29uc3RydWN0b3IiLCJuYW1lIiwiY2FwdHVyZVN0YWNrVHJhY2UiLCJoYW5kbGVFcnJvciIsImNvbnNvbGUiLCJ3aXRoRXJyb3JIYW5kbGVyIiwiaGFuZGxlciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/middleware/error.ts\n");

/***/ }),

/***/ "(api)/./src/middleware/rateLimit.ts":
/*!*************************************!*\
  !*** ./src/middleware/rateLimit.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   cleanupRateLimits: () => (/* binding */ cleanupRateLimits),\n/* harmony export */   withRateLimit: () => (/* binding */ withRateLimit)\n/* harmony export */ });\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/logger */ \"(api)/./src/lib/logger.ts\");\n/* harmony import */ var _lib_redis__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/redis */ \"(api)/./src/lib/redis.ts\");\n\n\nconst defaultConfig = {\n    windowMs: 15 * 60 * 1000,\n    max: 100,\n    keyPrefix: \"rate_limit:\"\n};\nfunction withRateLimit(handler, config = {}) {\n    const finalConfig = {\n        ...defaultConfig,\n        ...config\n    };\n    let redis = null;\n    try {\n        redis = (0,_lib_redis__WEBPACK_IMPORTED_MODULE_1__.getRedisClient)();\n    } catch (e) {\n        redis = null;\n    }\n    return async (req, res)=>{\n        if (!redis) {\n            // اگر Redis در دسترس نبود (مثلاً در محیط dev)، rate limit را نادیده بگیر و ادامه بده\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.logger.warn(\"Redis is not available, skipping rate limiting for all requests.\");\n            return handler(req, res);\n        }\n        try {\n            const ip = req.headers[\"x-forwarded-for\"] || req.socket.remoteAddress;\n            const key = `${finalConfig.keyPrefix}${ip}`;\n            const current = await redis.incr(key);\n            if (current === 1) {\n                await redis.expire(key, finalConfig.windowMs / 1000);\n            }\n            if (current > finalConfig.max) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_0__.logger.warn(`Rate limit exceeded for IP: ${ip}`, req);\n                return res.status(429).json({\n                    success: false,\n                    error: {\n                        message: \"تعداد درخواست‌های شما بیش از حد مجاز است\",\n                        code: \"RATE_LIMIT_EXCEEDED\"\n                    }\n                });\n            }\n            return handler(req, res);\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Rate limit middleware error:\", error);\n            // اگر خطای Redis بود، rate limit را نادیده بگیر و ادامه بده\n            return handler(req, res);\n        }\n    };\n}\nconst cleanupRateLimits = async ()=>{\n    const redis = (0,_lib_redis__WEBPACK_IMPORTED_MODULE_1__.getRedisClient)();\n    try {\n        const keys = await redis.keys(`${defaultConfig.keyPrefix}*`);\n        if (keys.length > 0) {\n            await redis.del(...keys);\n        }\n    } catch (error) {\n        _lib_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Rate limit cleanup error:\", error);\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbWlkZGxld2FyZS9yYXRlTGltaXQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUVzQztBQUVPO0FBUTdDLE1BQU1FLGdCQUFpQztJQUNyQ0MsVUFBVSxLQUFLLEtBQUs7SUFDcEJDLEtBQUs7SUFDTEMsV0FBVztBQUNiO0FBRU8sU0FBU0MsY0FBaUJDLE9BQXNCLEVBQUVDLFNBQW1DLENBQUMsQ0FBQztJQUM1RixNQUFNQyxjQUFjO1FBQUUsR0FBR1AsYUFBYTtRQUFFLEdBQUdNLE1BQU07SUFBQztJQUNsRCxJQUFJRSxRQUFzQjtJQUMxQixJQUFJO1FBQ0ZBLFFBQVFULDBEQUFjQTtJQUN4QixFQUFFLE9BQU9VLEdBQUc7UUFDVkQsUUFBUTtJQUNWO0lBRUEsT0FBTyxPQUFPRSxLQUFxQkM7UUFDakMsSUFBSSxDQUFDSCxPQUFPO1lBQ1YscUZBQXFGO1lBQ3JGViwrQ0FBTUEsQ0FBQ2MsSUFBSSxDQUFDO1lBQ1osT0FBT1AsUUFBUUssS0FBS0M7UUFDdEI7UUFDQSxJQUFJO1lBQ0YsTUFBTUUsS0FBS0gsSUFBSUksT0FBTyxDQUFDLGtCQUFrQixJQUFJSixJQUFJSyxNQUFNLENBQUNDLGFBQWE7WUFDckUsTUFBTUMsTUFBTSxDQUFDLEVBQUVWLFlBQVlKLFNBQVMsQ0FBQyxFQUFFVSxHQUFHLENBQUM7WUFFM0MsTUFBTUssVUFBVSxNQUFNVixNQUFNVyxJQUFJLENBQUNGO1lBQ2pDLElBQUlDLFlBQVksR0FBRztnQkFDakIsTUFBTVYsTUFBTVksTUFBTSxDQUFDSCxLQUFLVixZQUFZTixRQUFRLEdBQUc7WUFDakQ7WUFFQSxJQUFJaUIsVUFBVVgsWUFBWUwsR0FBRyxFQUFFO2dCQUM3QkosK0NBQU1BLENBQUNjLElBQUksQ0FBQyxDQUFDLDRCQUE0QixFQUFFQyxHQUFHLENBQUMsRUFBRUg7Z0JBQ2pELE9BQU9DLElBQUlVLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQzFCQyxTQUFTO29CQUNUQyxPQUFPO3dCQUNMQyxTQUFTO3dCQUNUQyxNQUFNO29CQUNSO2dCQUNGO1lBQ0Y7WUFFQSxPQUFPckIsUUFBUUssS0FBS0M7UUFDdEIsRUFBRSxPQUFPYSxPQUFPO1lBQ2QxQiwrQ0FBTUEsQ0FBQzBCLEtBQUssQ0FBQyxnQ0FBZ0NBO1lBQzdDLDREQUE0RDtZQUM1RCxPQUFPbkIsUUFBUUssS0FBS0M7UUFDdEI7SUFDRjtBQUNGO0FBRU8sTUFBTWdCLG9CQUFvQjtJQUMvQixNQUFNbkIsUUFBUVQsMERBQWNBO0lBQzVCLElBQUk7UUFDRixNQUFNNkIsT0FBTyxNQUFNcEIsTUFBTW9CLElBQUksQ0FBQyxDQUFDLEVBQUU1QixjQUFjRyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQzNELElBQUl5QixLQUFLQyxNQUFNLEdBQUcsR0FBRztZQUNuQixNQUFNckIsTUFBTXNCLEdBQUcsSUFBSUY7UUFDckI7SUFDRixFQUFFLE9BQU9KLE9BQU87UUFDZDFCLCtDQUFNQSxDQUFDMEIsS0FBSyxDQUFDLDZCQUE2QkE7SUFDNUM7QUFDRixFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZWR1Y2F0aW9uYWwtcGxhdGZvcm0vLi9zcmMvbWlkZGxld2FyZS9yYXRlTGltaXQudHM/ZmI2OSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcbmltcG9ydCB0eXBlIHsgQXBpUmVzcG9uc2UsIEFwaUhhbmRsZXIgfSBmcm9tICdAL3R5cGVzL2FwaSc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAL2xpYi9sb2dnZXInO1xuaW1wb3J0IHsgUmVkaXMgfSBmcm9tICdpb3JlZGlzJztcbmltcG9ydCB7IGdldFJlZGlzQ2xpZW50IH0gZnJvbSAnQC9saWIvcmVkaXMnO1xuXG5pbnRlcmZhY2UgUmF0ZUxpbWl0Q29uZmlnIHtcbiAgd2luZG93TXM6IG51bWJlcjtcbiAgbWF4OiBudW1iZXI7XG4gIGtleVByZWZpeD86IHN0cmluZztcbn1cblxuY29uc3QgZGVmYXVsdENvbmZpZzogUmF0ZUxpbWl0Q29uZmlnID0ge1xuICB3aW5kb3dNczogMTUgKiA2MCAqIDEwMDAsIC8vIDE1IG1pbnV0ZXNcbiAgbWF4OiAxMDAsIC8vIGxpbWl0IGVhY2ggSVAgdG8gMTAwIHJlcXVlc3RzIHBlciB3aW5kb3dNc1xuICBrZXlQcmVmaXg6ICdyYXRlX2xpbWl0Oidcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiB3aXRoUmF0ZUxpbWl0PFQ+KGhhbmRsZXI6IEFwaUhhbmRsZXI8VD4sIGNvbmZpZzogUGFydGlhbDxSYXRlTGltaXRDb25maWc+ID0ge30pIHtcbiAgY29uc3QgZmluYWxDb25maWcgPSB7IC4uLmRlZmF1bHRDb25maWcsIC4uLmNvbmZpZyB9O1xuICBsZXQgcmVkaXM6IFJlZGlzIHwgbnVsbCA9IG51bGw7XG4gIHRyeSB7XG4gICAgcmVkaXMgPSBnZXRSZWRpc0NsaWVudCgpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgcmVkaXMgPSBudWxsO1xuICB9XG5cbiAgcmV0dXJuIGFzeW5jIChyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZTxBcGlSZXNwb25zZTxUPj4pID0+IHtcbiAgICBpZiAoIXJlZGlzKSB7XG4gICAgICAvLyDYp9qv2LEgUmVkaXMg2K/YsSDYr9iz2KrYsdizINmG2KjZiNivICjZhdir2YTYp9mLINiv2LEg2YXYrduM2LcgZGV2KdiMIHJhdGUgbGltaXQg2LHYpyDZhtin2K/bjNiv2Ycg2Kjar9uM2LEg2Ygg2KfYr9in2YXZhyDYqNiv2YdcbiAgICAgIGxvZ2dlci53YXJuKCdSZWRpcyBpcyBub3QgYXZhaWxhYmxlLCBza2lwcGluZyByYXRlIGxpbWl0aW5nIGZvciBhbGwgcmVxdWVzdHMuJyk7XG4gICAgICByZXR1cm4gaGFuZGxlcihyZXEsIHJlcyk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBpcCA9IHJlcS5oZWFkZXJzWyd4LWZvcndhcmRlZC1mb3InXSB8fCByZXEuc29ja2V0LnJlbW90ZUFkZHJlc3M7XG4gICAgICBjb25zdCBrZXkgPSBgJHtmaW5hbENvbmZpZy5rZXlQcmVmaXh9JHtpcH1gO1xuXG4gICAgICBjb25zdCBjdXJyZW50ID0gYXdhaXQgcmVkaXMuaW5jcihrZXkpO1xuICAgICAgaWYgKGN1cnJlbnQgPT09IDEpIHtcbiAgICAgICAgYXdhaXQgcmVkaXMuZXhwaXJlKGtleSwgZmluYWxDb25maWcud2luZG93TXMgLyAxMDAwKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGN1cnJlbnQgPiBmaW5hbENvbmZpZy5tYXgpIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oYFJhdGUgbGltaXQgZXhjZWVkZWQgZm9yIElQOiAke2lwfWAsIHJlcSk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQyOSkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICfYqti52K/Yp9ivINiv2LHYrtmI2KfYs9iq4oCM2YfYp9uMINi02YXYpyDYqNuM2LQg2KfYsiDYrdivINmF2KzYp9iyINin2LPYqicsXG4gICAgICAgICAgICBjb2RlOiAnUkFURV9MSU1JVF9FWENFRURFRCdcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gaGFuZGxlcihyZXEsIHJlcyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignUmF0ZSBsaW1pdCBtaWRkbGV3YXJlIGVycm9yOicsIGVycm9yKTtcbiAgICAgIC8vINin2q/YsSDYrti32KfbjCBSZWRpcyDYqNmI2K/YjCByYXRlIGxpbWl0INix2Kcg2YbYp9iv24zYr9mHINio2q/bjNixINmIINin2K/Yp9mF2Ycg2KjYr9mHXG4gICAgICByZXR1cm4gaGFuZGxlcihyZXEsIHJlcyk7XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgY29uc3QgY2xlYW51cFJhdGVMaW1pdHMgPSBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IHJlZGlzID0gZ2V0UmVkaXNDbGllbnQoKTtcbiAgdHJ5IHtcbiAgICBjb25zdCBrZXlzID0gYXdhaXQgcmVkaXMua2V5cyhgJHtkZWZhdWx0Q29uZmlnLmtleVByZWZpeH0qYCk7XG4gICAgaWYgKGtleXMubGVuZ3RoID4gMCkge1xuICAgICAgYXdhaXQgcmVkaXMuZGVsKC4uLmtleXMpO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ1JhdGUgbGltaXQgY2xlYW51cCBlcnJvcjonLCBlcnJvcik7XG4gIH1cbn07ICJdLCJuYW1lcyI6WyJsb2dnZXIiLCJnZXRSZWRpc0NsaWVudCIsImRlZmF1bHRDb25maWciLCJ3aW5kb3dNcyIsIm1heCIsImtleVByZWZpeCIsIndpdGhSYXRlTGltaXQiLCJoYW5kbGVyIiwiY29uZmlnIiwiZmluYWxDb25maWciLCJyZWRpcyIsImUiLCJyZXEiLCJyZXMiLCJ3YXJuIiwiaXAiLCJoZWFkZXJzIiwic29ja2V0IiwicmVtb3RlQWRkcmVzcyIsImtleSIsImN1cnJlbnQiLCJpbmNyIiwiZXhwaXJlIiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJlcnJvciIsIm1lc3NhZ2UiLCJjb2RlIiwiY2xlYW51cFJhdGVMaW1pdHMiLCJrZXlzIiwibGVuZ3RoIiwiZGVsIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/middleware/rateLimit.ts\n");

/***/ }),

/***/ "(api)/./src/middleware/security.ts":
/*!************************************!*\
  !*** ./src/middleware/security.ts ***!
  \************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   withHelmet: () => (/* binding */ withHelmet),\n/* harmony export */   withSecurity: () => (/* binding */ withSecurity)\n/* harmony export */ });\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/logger */ \"(api)/./src/lib/logger.ts\");\n/* harmony import */ var _lib_sanitize__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/sanitize */ \"(api)/./src/lib/sanitize.ts\");\n/* harmony import */ var _error__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./error */ \"(api)/./src/middleware/error.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_sanitize__WEBPACK_IMPORTED_MODULE_1__, _error__WEBPACK_IMPORTED_MODULE_2__]);\n([_lib_sanitize__WEBPACK_IMPORTED_MODULE_1__, _error__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n// Comment out or remove limiter and withRateLimiting, and add a comment that for Next.js, use a Next.js-compatible rate limiter instead of express-rate-limit.\n// Security headers\nconst securityHeaders = {\n    \"X-Content-Type-Options\": \"nosniff\",\n    \"X-Frame-Options\": \"DENY\",\n    \"X-XSS-Protection\": \"1; mode=block\",\n    \"Referrer-Policy\": \"strict-origin-when-cross-origin\",\n    \"Permissions-Policy\": \"camera=(), microphone=(), geolocation=()\",\n    \"Content-Security-Policy\": `\n    default-src 'self';\n    script-src 'self' 'unsafe-inline' 'unsafe-eval';\n    style-src 'self' 'unsafe-inline';\n    img-src 'self' data: https:;\n    font-src 'self';\n    object-src 'none';\n    base-uri 'self';\n    form-action 'self';\n    frame-ancestors 'none';\n    block-all-mixed-content;\n    upgrade-insecure-requests;\n  `.replace(/\\s+/g, \" \").trim(),\n    \"Strict-Transport-Security\": \"max-age=31536000; includeSubDomains\"\n};\n// Input sanitization\nconst sanitizeInput = (input)=>{\n    return input.replace(/[<>]/g, \"\") // Remove < and >\n    .replace(/javascript:/gi, \"\") // Remove javascript: protocol\n    .replace(/on\\w+=/gi, \"\") // Remove on* attributes\n    .trim();\n};\n// Request validation\nconst validateRequest = (req)=>{\n    const { method, url, headers } = req;\n    // Check for suspicious headers\n    const suspiciousHeaders = [\n        \"x-forwarded-for\",\n        \"x-real-ip\"\n    ];\n    for (const header of suspiciousHeaders){\n        if (headers[header]) {\n            throw new _error__WEBPACK_IMPORTED_MODULE_2__.AppError(\"درخواست نامعتبر\", 400, \"INVALID_REQUEST\");\n        }\n    }\n    // Validate URL\n    if (url && !/^[a-zA-Z0-9\\-._~:/?#[\\]@!$&'()*+,;=]+$/.test(url)) {\n        throw new _error__WEBPACK_IMPORTED_MODULE_2__.AppError(\"URL نامعتبر\", 400, \"INVALID_URL\");\n    }\n    // Validate method\n    const allowedMethods = [\n        \"GET\",\n        \"POST\",\n        \"PUT\",\n        \"DELETE\",\n        \"PATCH\"\n    ];\n    if (!allowedMethods.includes(method || \"\")) {\n        throw new _error__WEBPACK_IMPORTED_MODULE_2__.AppError(\"متد نامعتبر\", 405, \"INVALID_METHOD\");\n    }\n};\n// Sanitize object recursively\nconst sanitizeObject = (obj)=>{\n    if (obj === null || obj === undefined) {\n        return obj;\n    }\n    if (typeof obj === \"string\") {\n        return (0,_lib_sanitize__WEBPACK_IMPORTED_MODULE_1__.sanitizeHtml)(obj);\n    }\n    if (Array.isArray(obj)) {\n        return obj.map(sanitizeObject);\n    }\n    if (typeof obj === \"object\") {\n        const sanitized = {};\n        for (const [key, value] of Object.entries(obj)){\n            sanitized[key] = sanitizeObject(value);\n        }\n        return sanitized;\n    }\n    return obj;\n};\n// Security middleware\nconst withSecurity = (handler)=>{\n    return async (req, res)=>{\n        try {\n            // Sanitize query parameters\n            if (req.query) {\n                req.query = sanitizeObject(req.query);\n            }\n            // Sanitize body\n            if (req.body) {\n                req.body = sanitizeObject(req.body);\n            }\n            // Add security headers\n            Object.entries(securityHeaders).forEach(([key, value])=>{\n                res.setHeader(key, value);\n            });\n            await handler(req, res);\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Security middleware error:\", error);\n            throw error;\n        }\n    };\n};\n// Export individual security functions for specific use cases\nconst withHelmet = (handler)=>{\n    return async (req, res)=>{\n        try {\n            // Apply security headers directly instead of using helmet\n            Object.entries(securityHeaders).forEach(([key, value])=>{\n                res.setHeader(key, value);\n            });\n            return handler(req, res);\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Helmet middleware error\", error, req);\n            return res.status(500).json({\n                success: false,\n                error: {\n                    message: \"خطا در تنظیمات امنیتی\",\n                    code: \"HELMET_ERROR\"\n                }\n            });\n        }\n    };\n}; // Comment out or remove limiter and withRateLimiting, and add a comment that for Next.js, use a Next.js-compatible rate limiter instead of express-rate-limit. \n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBTUEsQ0FBQ29DLEtBQUssQ0FBQyw4QkFBOEJBO1lBQzNDLE1BQU1BO1FBQ1I7SUFDRjtBQUNGLEVBQUU7QUFFRiw4REFBOEQ7QUFDdkQsTUFBTUMsYUFBYSxDQUFDUDtJQUN6QixPQUFPLE9BQU9yQixLQUFxQnNCO1FBQ2pDLElBQUk7WUFDRiwwREFBMEQ7WUFDMURKLE9BQU9DLE9BQU8sQ0FBQ3pCLGlCQUFpQitCLE9BQU8sQ0FBQyxDQUFDLENBQUNULEtBQUtDLE1BQU07Z0JBQ25ESyxJQUFJSSxTQUFTLENBQUNWLEtBQUtDO1lBQ3JCO1lBQ0EsT0FBT0ksUUFBUXJCLEtBQUtzQjtRQUN0QixFQUFFLE9BQU9LLE9BQU87WUFDZHBDLCtDQUFNQSxDQUFDb0MsS0FBSyxDQUFDLDJCQUEyQkEsT0FBTzNCO1lBQy9DLE9BQU9zQixJQUFJTyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUMxQkMsU0FBUztnQkFDVEosT0FBTztvQkFDTEssU0FBUztvQkFDVEMsTUFBTTtnQkFDUjtZQUNGO1FBQ0Y7SUFDRjtBQUNGLEVBQUUsQ0FFRixnS0FBZ0siLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9lZHVjYXRpb25hbC1wbGF0Zm9ybS8uL3NyYy9taWRkbGV3YXJlL3NlY3VyaXR5LnRzPzZlZWQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQgdHlwZSB7IEFwaVJlc3BvbnNlLCBBcGlIYW5kbGVyIH0gZnJvbSAnQC90eXBlcy9hcGknO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnQC9saWIvbG9nZ2VyJztcbmltcG9ydCB7IHNhbml0aXplSHRtbCB9IGZyb20gJ0AvbGliL3Nhbml0aXplJztcbmltcG9ydCBoZWxtZXQgZnJvbSAnaGVsbWV0JztcbmltcG9ydCB7IEFwcEVycm9yIH0gZnJvbSAnLi9lcnJvcic7XG5cbi8vIENvbW1lbnQgb3V0IG9yIHJlbW92ZSBsaW1pdGVyIGFuZCB3aXRoUmF0ZUxpbWl0aW5nLCBhbmQgYWRkIGEgY29tbWVudCB0aGF0IGZvciBOZXh0LmpzLCB1c2UgYSBOZXh0LmpzLWNvbXBhdGlibGUgcmF0ZSBsaW1pdGVyIGluc3RlYWQgb2YgZXhwcmVzcy1yYXRlLWxpbWl0LlxuXG4vLyBTZWN1cml0eSBoZWFkZXJzXG5jb25zdCBzZWN1cml0eUhlYWRlcnMgPSB7XG4gICdYLUNvbnRlbnQtVHlwZS1PcHRpb25zJzogJ25vc25pZmYnLFxuICAnWC1GcmFtZS1PcHRpb25zJzogJ0RFTlknLFxuICAnWC1YU1MtUHJvdGVjdGlvbic6ICcxOyBtb2RlPWJsb2NrJyxcbiAgJ1JlZmVycmVyLVBvbGljeSc6ICdzdHJpY3Qtb3JpZ2luLXdoZW4tY3Jvc3Mtb3JpZ2luJyxcbiAgJ1Blcm1pc3Npb25zLVBvbGljeSc6ICdjYW1lcmE9KCksIG1pY3JvcGhvbmU9KCksIGdlb2xvY2F0aW9uPSgpJyxcbiAgJ0NvbnRlbnQtU2VjdXJpdHktUG9saWN5JzogYFxuICAgIGRlZmF1bHQtc3JjICdzZWxmJztcbiAgICBzY3JpcHQtc3JjICdzZWxmJyAndW5zYWZlLWlubGluZScgJ3Vuc2FmZS1ldmFsJztcbiAgICBzdHlsZS1zcmMgJ3NlbGYnICd1bnNhZmUtaW5saW5lJztcbiAgICBpbWctc3JjICdzZWxmJyBkYXRhOiBodHRwczo7XG4gICAgZm9udC1zcmMgJ3NlbGYnO1xuICAgIG9iamVjdC1zcmMgJ25vbmUnO1xuICAgIGJhc2UtdXJpICdzZWxmJztcbiAgICBmb3JtLWFjdGlvbiAnc2VsZic7XG4gICAgZnJhbWUtYW5jZXN0b3JzICdub25lJztcbiAgICBibG9jay1hbGwtbWl4ZWQtY29udGVudDtcbiAgICB1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzO1xuICBgLnJlcGxhY2UoL1xccysvZywgJyAnKS50cmltKCksXG4gICdTdHJpY3QtVHJhbnNwb3J0LVNlY3VyaXR5JzogJ21heC1hZ2U9MzE1MzYwMDA7IGluY2x1ZGVTdWJEb21haW5zJ1xufTtcblxuLy8gSW5wdXQgc2FuaXRpemF0aW9uXG5jb25zdCBzYW5pdGl6ZUlucHV0ID0gKGlucHV0OiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICByZXR1cm4gaW5wdXRcbiAgICAucmVwbGFjZSgvWzw+XS9nLCAnJykgLy8gUmVtb3ZlIDwgYW5kID5cbiAgICAucmVwbGFjZSgvamF2YXNjcmlwdDovZ2ksICcnKSAvLyBSZW1vdmUgamF2YXNjcmlwdDogcHJvdG9jb2xcbiAgICAucmVwbGFjZSgvb25cXHcrPS9naSwgJycpIC8vIFJlbW92ZSBvbiogYXR0cmlidXRlc1xuICAgIC50cmltKCk7XG59O1xuXG4vLyBSZXF1ZXN0IHZhbGlkYXRpb25cbmNvbnN0IHZhbGlkYXRlUmVxdWVzdCA9IChyZXE6IE5leHRBcGlSZXF1ZXN0KTogdm9pZCA9PiB7XG4gIGNvbnN0IHsgbWV0aG9kLCB1cmwsIGhlYWRlcnMgfSA9IHJlcTtcblxuICAvLyBDaGVjayBmb3Igc3VzcGljaW91cyBoZWFkZXJzXG4gIGNvbnN0IHN1c3BpY2lvdXNIZWFkZXJzID0gWyd4LWZvcndhcmRlZC1mb3InLCAneC1yZWFsLWlwJ107XG4gIGZvciAoY29uc3QgaGVhZGVyIG9mIHN1c3BpY2lvdXNIZWFkZXJzKSB7XG4gICAgaWYgKGhlYWRlcnNbaGVhZGVyXSkge1xuICAgICAgdGhyb3cgbmV3IEFwcEVycm9yKCfYr9ix2K7ZiNin2LPYqiDZhtin2YXYudiq2KjYsScsIDQwMCwgJ0lOVkFMSURfUkVRVUVTVCcpO1xuICAgIH1cbiAgfVxuXG4gIC8vIFZhbGlkYXRlIFVSTFxuICBpZiAodXJsICYmICEvXlthLXpBLVowLTlcXC0uX346Lz8jW1xcXUAhJCYnKCkqKyw7PV0rJC8udGVzdCh1cmwpKSB7XG4gICAgdGhyb3cgbmV3IEFwcEVycm9yKCdVUkwg2YbYp9mF2LnYqtio2LEnLCA0MDAsICdJTlZBTElEX1VSTCcpO1xuICB9XG5cbiAgLy8gVmFsaWRhdGUgbWV0aG9kXG4gIGNvbnN0IGFsbG93ZWRNZXRob2RzID0gWydHRVQnLCAnUE9TVCcsICdQVVQnLCAnREVMRVRFJywgJ1BBVENIJ107XG4gIGlmICghYWxsb3dlZE1ldGhvZHMuaW5jbHVkZXMobWV0aG9kIHx8ICcnKSkge1xuICAgIHRocm93IG5ldyBBcHBFcnJvcign2YXYqtivINmG2KfZhdi52KrYqNixJywgNDA1LCAnSU5WQUxJRF9NRVRIT0QnKTtcbiAgfVxufTtcblxuLy8gU2FuaXRpemUgb2JqZWN0IHJlY3Vyc2l2ZWx5XG5jb25zdCBzYW5pdGl6ZU9iamVjdCA9IChvYmo6IGFueSk6IGFueSA9PiB7XG4gIGlmIChvYmogPT09IG51bGwgfHwgb2JqID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gb2JqO1xuICB9XG5cbiAgaWYgKHR5cGVvZiBvYmogPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIHNhbml0aXplSHRtbChvYmopO1xuICB9XG5cbiAgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuICAgIHJldHVybiBvYmoubWFwKHNhbml0aXplT2JqZWN0KTtcbiAgfVxuXG4gIGlmICh0eXBlb2Ygb2JqID09PSAnb2JqZWN0Jykge1xuICAgIGNvbnN0IHNhbml0aXplZDogYW55ID0ge307XG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMob2JqKSkge1xuICAgICAgc2FuaXRpemVkW2tleV0gPSBzYW5pdGl6ZU9iamVjdCh2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiBzYW5pdGl6ZWQ7XG4gIH1cblxuICByZXR1cm4gb2JqO1xufTtcblxuLy8gU2VjdXJpdHkgbWlkZGxld2FyZVxuZXhwb3J0IGNvbnN0IHdpdGhTZWN1cml0eSA9IDxUPihoYW5kbGVyOiBBcGlIYW5kbGVyPFQ+KSA9PiB7XG4gIHJldHVybiBhc3luYyAocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2U8QXBpUmVzcG9uc2U8VD4+KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFNhbml0aXplIHF1ZXJ5IHBhcmFtZXRlcnNcbiAgICAgIGlmIChyZXEucXVlcnkpIHtcbiAgICAgICAgcmVxLnF1ZXJ5ID0gc2FuaXRpemVPYmplY3QocmVxLnF1ZXJ5KTtcbiAgICAgIH1cblxuICAgICAgLy8gU2FuaXRpemUgYm9keVxuICAgICAgaWYgKHJlcS5ib2R5KSB7XG4gICAgICAgIHJlcS5ib2R5ID0gc2FuaXRpemVPYmplY3QocmVxLmJvZHkpO1xuICAgICAgfVxuXG4gICAgICAvLyBBZGQgc2VjdXJpdHkgaGVhZGVyc1xuICAgICAgT2JqZWN0LmVudHJpZXMoc2VjdXJpdHlIZWFkZXJzKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgcmVzLnNldEhlYWRlcihrZXksIHZhbHVlKTtcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBoYW5kbGVyKHJlcSwgcmVzKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdTZWN1cml0eSBtaWRkbGV3YXJlIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfTtcbn07XG5cbi8vIEV4cG9ydCBpbmRpdmlkdWFsIHNlY3VyaXR5IGZ1bmN0aW9ucyBmb3Igc3BlY2lmaWMgdXNlIGNhc2VzXG5leHBvcnQgY29uc3Qgd2l0aEhlbG1ldCA9IChoYW5kbGVyOiBBcGlIYW5kbGVyKSA9PiB7XG4gIHJldHVybiBhc3luYyAocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2U8QXBpUmVzcG9uc2U8YW55Pj4pID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQXBwbHkgc2VjdXJpdHkgaGVhZGVycyBkaXJlY3RseSBpbnN0ZWFkIG9mIHVzaW5nIGhlbG1ldFxuICAgICAgT2JqZWN0LmVudHJpZXMoc2VjdXJpdHlIZWFkZXJzKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgcmVzLnNldEhlYWRlcihrZXksIHZhbHVlKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGhhbmRsZXIocmVxLCByZXMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0hlbG1ldCBtaWRkbGV3YXJlIGVycm9yJywgZXJyb3IsIHJlcSk7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBtZXNzYWdlOiAn2K7Yt9inINiv2LEg2KrZhti424zZhdin2Kog2KfZhdmG24zYqtuMJyxcbiAgICAgICAgICBjb2RlOiAnSEVMTUVUX0VSUk9SJ1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG59O1xuXG4vLyBDb21tZW50IG91dCBvciByZW1vdmUgbGltaXRlciBhbmQgd2l0aFJhdGVMaW1pdGluZywgYW5kIGFkZCBhIGNvbW1lbnQgdGhhdCBmb3IgTmV4dC5qcywgdXNlIGEgTmV4dC5qcy1jb21wYXRpYmxlIHJhdGUgbGltaXRlciBpbnN0ZWFkIG9mIGV4cHJlc3MtcmF0ZS1saW1pdC4gIl0sIm5hbWVzIjpbImxvZ2dlciIsInNhbml0aXplSHRtbCIsIkFwcEVycm9yIiwic2VjdXJpdHlIZWFkZXJzIiwicmVwbGFjZSIsInRyaW0iLCJzYW5pdGl6ZUlucHV0IiwiaW5wdXQiLCJ2YWxpZGF0ZVJlcXVlc3QiLCJyZXEiLCJtZXRob2QiLCJ1cmwiLCJoZWFkZXJzIiwic3VzcGljaW91c0hlYWRlcnMiLCJoZWFkZXIiLCJ0ZXN0IiwiYWxsb3dlZE1ldGhvZHMiLCJpbmNsdWRlcyIsInNhbml0aXplT2JqZWN0Iiwib2JqIiwidW5kZWZpbmVkIiwiQXJyYXkiLCJpc0FycmF5IiwibWFwIiwic2FuaXRpemVkIiwia2V5IiwidmFsdWUiLCJPYmplY3QiLCJlbnRyaWVzIiwid2l0aFNlY3VyaXR5IiwiaGFuZGxlciIsInJlcyIsInF1ZXJ5IiwiYm9keSIsImZvckVhY2giLCJzZXRIZWFkZXIiLCJlcnJvciIsIndpdGhIZWxtZXQiLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJjb2RlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/middleware/security.ts\n");

/***/ }),

/***/ "(api)/./src/pages/api/users/index.ts":
/*!**************************************!*\
  !*** ./src/pages/api/users/index.ts ***!
  \**************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/prisma */ \"(api)/./src/lib/prisma.ts\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bcryptjs */ \"bcryptjs\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _middleware_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/middleware/auth */ \"(api)/./src/middleware/auth.ts\");\n/* harmony import */ var _middleware_rateLimit__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/middleware/rateLimit */ \"(api)/./src/middleware/rateLimit.ts\");\n/* harmony import */ var _middleware_security__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/middleware/security */ \"(api)/./src/middleware/security.ts\");\n/* harmony import */ var _utils_roleMap__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/utils/roleMap */ \"(api)/./src/utils/roleMap.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_middleware_security__WEBPACK_IMPORTED_MODULE_4__]);\n_middleware_security__WEBPACK_IMPORTED_MODULE_4__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\nconst handler = async (req, res)=>{\n    if (req.method === \"GET\") {\n        try {\n            // صفحه‌بندی\n            const page = parseInt(req.query.page) || 1;\n            const limit = parseInt(req.query.limit) || 10;\n            const skip = (page - 1) * limit;\n            const [total, users] = await Promise.all([\n                _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.count(),\n                _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.findMany({\n                    orderBy: {\n                        createdAt: \"desc\"\n                    },\n                    skip,\n                    take: limit,\n                    select: {\n                        id: true,\n                        name: true,\n                        email: true,\n                        role: true,\n                        createdAt: true,\n                        updatedAt: true\n                    }\n                })\n            ]);\n            return res.status(200).json({\n                success: true,\n                data: {\n                    users,\n                    total,\n                    page,\n                    limit\n                }\n            });\n        } catch  {\n            return res.status(500).json({\n                success: false,\n                error: {\n                    message: \"خطا در دریافت کاربران\",\n                    code: \"INTERNAL_SERVER_ERROR\"\n                }\n            });\n        }\n    }\n    if (req.method === \"POST\") {\n        try {\n            const { email, name, password, role } = req.body;\n            if (!email || !name || !password || !role) {\n                return res.status(400).json({\n                    success: false,\n                    error: {\n                        message: \"همه فیلدها الزامی است\",\n                        code: \"BAD_REQUEST\"\n                    }\n                });\n            }\n            // اعتبارسنجی ایمیل و رمز عبور و نام\n            const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n            if (!emailRegex.test(email)) {\n                return res.status(400).json({\n                    success: false,\n                    error: {\n                        message: \"ایمیل نامعتبر است\",\n                        code: \"BAD_REQUEST\"\n                    }\n                });\n            }\n            if (password.length < 8) {\n                return res.status(400).json({\n                    success: false,\n                    error: {\n                        message: \"رمز عبور باید حداقل 8 کاراکتر باشد\",\n                        code: \"BAD_REQUEST\"\n                    }\n                });\n            }\n            // بررسی تکراری نبودن ایمیل\n            const existing = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.findUnique({\n                where: {\n                    email\n                }\n            });\n            if (existing) {\n                return res.status(400).json({\n                    success: false,\n                    error: {\n                        message: \"این ایمیل قبلاً ثبت شده است\",\n                        code: \"EMAIL_EXISTS\"\n                    }\n                });\n            }\n            // رمزنگاری رمز عبور\n            const hashedPassword = await bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().hash(password, 12);\n            const user = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.create({\n                data: {\n                    email,\n                    name,\n                    password: hashedPassword,\n                    role: (0,_utils_roleMap__WEBPACK_IMPORTED_MODULE_5__.normalizeRole)(role)\n                },\n                select: {\n                    id: true,\n                    name: true,\n                    email: true,\n                    role: true,\n                    createdAt: true,\n                    updatedAt: true\n                }\n            });\n            return res.status(201).json({\n                success: true,\n                data: user\n            });\n        } catch  {\n            return res.status(500).json({\n                success: false,\n                error: {\n                    message: \"خطا در ایجاد کاربر\",\n                    code: \"INTERNAL_SERVER_ERROR\"\n                }\n            });\n        }\n    }\n    res.status(405).json({\n        success: false,\n        error: {\n            message: \"Method Not Allowed\",\n            code: \"METHOD_NOT_ALLOWED\"\n        }\n    });\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_middleware_security__WEBPACK_IMPORTED_MODULE_4__.withSecurity)((0,_middleware_rateLimit__WEBPACK_IMPORTED_MODULE_3__.withRateLimit)((0,_middleware_auth__WEBPACK_IMPORTED_MODULE_2__.withAuth)(handler), {\n    windowMs: 15 * 60 * 1000,\n    max: 100\n})));\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LCtDQUFNQSxDQUFDbUIsSUFBSSxDQUFDNkIsTUFBTSxDQUFDO2dCQUNwQ2QsTUFBTTtvQkFBRU47b0JBQU9EO29CQUFNVyxVQUFVUTtvQkFBZ0JqQixNQUFNeEIsNkRBQWFBLENBQUN3QjtnQkFBTTtnQkFDekVKLFFBQVE7b0JBQ05DLElBQUk7b0JBQ0pDLE1BQU07b0JBQ05DLE9BQU87b0JBQ1BDLE1BQU07b0JBQ05OLFdBQVc7b0JBQ1hPLFdBQVc7Z0JBQ2I7WUFDRjtZQUNBLE9BQU90QixJQUFJdUIsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsU0FBUztnQkFBTUMsTUFBTWY7WUFBSztRQUMxRCxFQUFFLE9BQU07WUFDTixPQUFPWCxJQUFJdUIsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsU0FBUztnQkFBT0UsT0FBTztvQkFBRUMsU0FBUztvQkFBc0JDLE1BQU07Z0JBQXdCO1lBQUU7UUFDeEg7SUFDRjtJQUVBN0IsSUFBSXVCLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7UUFBRUMsU0FBUztRQUFPRSxPQUFPO1lBQUVDLFNBQVM7WUFBc0JDLE1BQU07UUFBcUI7SUFBRTtBQUM5RztBQUVBLGlFQUFlakMsa0VBQVlBLENBQ3pCRCxvRUFBYUEsQ0FDWEQsMERBQVFBLENBQUNJLFVBQ1Q7SUFBRTJDLFVBQVUsS0FBSyxLQUFLO0lBQU1DLEtBQUs7QUFBSSxLQUV2QyIsInNvdXJjZXMiOlsid2VicGFjazovL2VkdWNhdGlvbmFsLXBsYXRmb3JtLy4vc3JjL3BhZ2VzL2FwaS91c2Vycy9pbmRleC50cz8xMzA2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xyXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICdAL2xpYi9wcmlzbWEnO1xyXG5pbXBvcnQgYmNyeXB0IGZyb20gJ2JjcnlwdGpzJztcclxuaW1wb3J0IHsgd2l0aEF1dGggfSBmcm9tICdAL21pZGRsZXdhcmUvYXV0aCc7XHJcbmltcG9ydCB7IHdpdGhSYXRlTGltaXQgfSBmcm9tICdAL21pZGRsZXdhcmUvcmF0ZUxpbWl0JztcclxuaW1wb3J0IHsgd2l0aFNlY3VyaXR5IH0gZnJvbSAnQC9taWRkbGV3YXJlL3NlY3VyaXR5JztcclxuaW1wb3J0IHsgbm9ybWFsaXplUm9sZSB9IGZyb20gJ0AvdXRpbHMvcm9sZU1hcCc7XHJcblxyXG5jb25zdCBoYW5kbGVyID0gYXN5bmMgKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSA9PiB7XHJcbiAgaWYgKHJlcS5tZXRob2QgPT09ICdHRVQnKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyDYtdmB2K3Zh+KAjNio2YbYr9uMXHJcbiAgICAgIGNvbnN0IHBhZ2UgPSBwYXJzZUludChyZXEucXVlcnkucGFnZSBhcyBzdHJpbmcpIHx8IDE7XHJcbiAgICAgIGNvbnN0IGxpbWl0ID0gcGFyc2VJbnQocmVxLnF1ZXJ5LmxpbWl0IGFzIHN0cmluZykgfHwgMTA7XHJcbiAgICAgIGNvbnN0IHNraXAgPSAocGFnZSAtIDEpICogbGltaXQ7XHJcbiAgICAgIGNvbnN0IFt0b3RhbCwgdXNlcnNdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xyXG4gICAgICAgIHByaXNtYS51c2VyLmNvdW50KCksXHJcbiAgICAgICAgcHJpc21hLnVzZXIuZmluZE1hbnkoe1xyXG4gICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxyXG4gICAgICAgICAgc2tpcCxcclxuICAgICAgICAgIHRha2U6IGxpbWl0LFxyXG4gICAgICAgICAgc2VsZWN0OiB7XHJcbiAgICAgICAgICAgIGlkOiB0cnVlLFxyXG4gICAgICAgICAgICBuYW1lOiB0cnVlLFxyXG4gICAgICAgICAgICBlbWFpbDogdHJ1ZSxcclxuICAgICAgICAgICAgcm9sZTogdHJ1ZSxcclxuICAgICAgICAgICAgY3JlYXRlZEF0OiB0cnVlLFxyXG4gICAgICAgICAgICB1cGRhdGVkQXQ6IHRydWUsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0pXHJcbiAgICAgIF0pO1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiB7IHVzZXJzLCB0b3RhbCwgcGFnZSwgbGltaXQgfSB9KTtcclxuICAgIH0gY2F0Y2gge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ9iu2LfYpyDYr9ixINiv2LHbjNin2YHYqiDaqdin2LHYqNix2KfZhicsIGNvZGU6ICdJTlRFUk5BTF9TRVJWRVJfRVJST1InIH0gfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpZiAocmVxLm1ldGhvZCA9PT0gJ1BPU1QnKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGVtYWlsLCBuYW1lLCBwYXNzd29yZCwgcm9sZSB9ID0gcmVxLmJvZHk7XHJcbiAgICAgIGlmICghZW1haWwgfHwgIW5hbWUgfHwgIXBhc3N3b3JkIHx8ICFyb2xlKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICfZh9mF2Ycg2YHbjNmE2K/Zh9inINin2YTYstin2YXbjCDYp9iz2KonLCBjb2RlOiAnQkFEX1JFUVVFU1QnIH0gfSk7XHJcbiAgICAgIH1cclxuICAgICAgLy8g2KfYudiq2KjYp9ix2LPZhtis24wg2KfbjNmF24zZhCDZiCDYsdmF2LIg2LnYqNmI2LEg2Ygg2YbYp9mFXHJcbiAgICAgIGNvbnN0IGVtYWlsUmVnZXggPSAvXlteXFxzQF0rQFteXFxzQF0rXFwuW15cXHNAXSskLztcclxuICAgICAgaWYgKCFlbWFpbFJlZ2V4LnRlc3QoZW1haWwpKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICfYp9uM2YXbjNmEINmG2KfZhdi52KrYqNixINin2LPYqicsIGNvZGU6ICdCQURfUkVRVUVTVCcgfSB9KTtcclxuICAgICAgfVxyXG4gICAgICBpZiAocGFzc3dvcmQubGVuZ3RoIDwgOCkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAn2LHZhdiyINi52KjZiNixINio2KfbjNivINit2K/Yp9mC2YQgOCDaqdin2LHYp9qp2KrYsSDYqNin2LTYrycsIGNvZGU6ICdCQURfUkVRVUVTVCcgfSB9KTtcclxuICAgICAgfVxyXG4gICAgICAvLyDYqNix2LHYs9uMINiq2qnYsdin2LHbjCDZhtio2YjYr9mGINin24zZhduM2YRcclxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kVW5pcXVlKHsgd2hlcmU6IHsgZW1haWwgfSB9KTtcclxuICAgICAgaWYgKGV4aXN0aW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICfYp9uM2YYg2KfbjNmF24zZhCDZgtio2YTYp9mLINir2KjYqiDYtNiv2Ycg2KfYs9iqJywgY29kZTogJ0VNQUlMX0VYSVNUUycgfSB9KTtcclxuICAgICAgfVxyXG4gICAgICAvLyDYsdmF2LLZhtqv2KfYsduMINix2YXYsiDYudio2YjYsVxyXG4gICAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGJjcnlwdC5oYXNoKHBhc3N3b3JkLCAxMik7XHJcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5jcmVhdGUoe1xyXG4gICAgICAgIGRhdGE6IHsgZW1haWwsIG5hbWUsIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCwgcm9sZTogbm9ybWFsaXplUm9sZShyb2xlKSB9LFxyXG4gICAgICAgIHNlbGVjdDoge1xyXG4gICAgICAgICAgaWQ6IHRydWUsXHJcbiAgICAgICAgICBuYW1lOiB0cnVlLFxyXG4gICAgICAgICAgZW1haWw6IHRydWUsXHJcbiAgICAgICAgICByb2xlOiB0cnVlLFxyXG4gICAgICAgICAgY3JlYXRlZEF0OiB0cnVlLFxyXG4gICAgICAgICAgdXBkYXRlZEF0OiB0cnVlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDEpLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiB1c2VyIH0pO1xyXG4gICAgfSBjYXRjaCB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAn2K7Yt9inINiv2LEg2KfbjNis2KfYryDaqdin2LHYqNixJywgY29kZTogJ0lOVEVSTkFMX1NFUlZFUl9FUlJPUicgfSB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdNZXRob2QgTm90IEFsbG93ZWQnLCBjb2RlOiAnTUVUSE9EX05PVF9BTExPV0VEJyB9IH0pO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgd2l0aFNlY3VyaXR5KFxyXG4gIHdpdGhSYXRlTGltaXQoXHJcbiAgICB3aXRoQXV0aChoYW5kbGVyKSxcclxuICAgIHsgd2luZG93TXM6IDE1ICogNjAgKiAxMDAwLCBtYXg6IDEwMCB9XHJcbiAgKVxyXG4pOyAiXSwibmFtZXMiOlsicHJpc21hIiwiYmNyeXB0Iiwid2l0aEF1dGgiLCJ3aXRoUmF0ZUxpbWl0Iiwid2l0aFNlY3VyaXR5Iiwibm9ybWFsaXplUm9sZSIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJwYWdlIiwicGFyc2VJbnQiLCJxdWVyeSIsImxpbWl0Iiwic2tpcCIsInRvdGFsIiwidXNlcnMiLCJQcm9taXNlIiwiYWxsIiwidXNlciIsImNvdW50IiwiZmluZE1hbnkiLCJvcmRlckJ5IiwiY3JlYXRlZEF0IiwidGFrZSIsInNlbGVjdCIsImlkIiwibmFtZSIsImVtYWlsIiwicm9sZSIsInVwZGF0ZWRBdCIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwiZGF0YSIsImVycm9yIiwibWVzc2FnZSIsImNvZGUiLCJwYXNzd29yZCIsImJvZHkiLCJlbWFpbFJlZ2V4IiwidGVzdCIsImxlbmd0aCIsImV4aXN0aW5nIiwiZmluZFVuaXF1ZSIsIndoZXJlIiwiaGFzaGVkUGFzc3dvcmQiLCJoYXNoIiwiY3JlYXRlIiwid2luZG93TXMiLCJtYXgiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/users/index.ts\n");

/***/ }),

/***/ "(api)/./src/utils/roleMap.ts":
/*!******************************!*\
  !*** ./src/utils/roleMap.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   normalizeRole: () => (/* binding */ normalizeRole),\n/* harmony export */   roleMap: () => (/* binding */ roleMap)\n/* harmony export */ });\nconst roleMap = {\n    \"ادمین\": \"ADMIN\",\n    \"admin\": \"ADMIN\",\n    \"Admin\": \"ADMIN\",\n    \"مدیر\": \"ADMIN\",\n    \"user\": \"USER\",\n    \"کاربر\": \"USER\",\n    \"کاربر عادی\": \"USER\",\n    \"USER\": \"USER\",\n    \"دانشجو\": \"STUDENT\",\n    \"student\": \"STUDENT\",\n    \"STUDENT\": \"STUDENT\",\n    \"استاد\": \"INSTRUCTOR\",\n    \"teacher\": \"INSTRUCTOR\",\n    \"instructor\": \"INSTRUCTOR\",\n    \"INSTRUCTOR\": \"INSTRUCTOR\"\n};\nfunction normalizeRole(role) {\n    return roleMap[role] || \"USER\";\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvdXRpbHMvcm9sZU1hcC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFPLE1BQU1BLFVBQWtDO0lBQzdDLFNBQVM7SUFDVCxTQUFTO0lBQ1QsU0FBUztJQUNULFFBQVE7SUFDUixRQUFRO0lBQ1IsU0FBUztJQUNULGNBQWM7SUFDZCxRQUFRO0lBQ1IsVUFBVTtJQUNWLFdBQVc7SUFDWCxXQUFXO0lBQ1gsU0FBUztJQUNULFdBQVc7SUFDWCxjQUFjO0lBQ2QsY0FBYztBQUNoQixFQUFFO0FBQ0ssU0FBU0MsY0FBY0MsSUFBWTtJQUN4QyxPQUFPRixPQUFPLENBQUNFLEtBQUssSUFBSTtBQUMxQiIsInNvdXJjZXMiOlsid2VicGFjazovL2VkdWNhdGlvbmFsLXBsYXRmb3JtLy4vc3JjL3V0aWxzL3JvbGVNYXAudHM/Y2YxZCJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3Qgcm9sZU1hcDogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcclxuICAn2KfYr9mF24zZhic6ICdBRE1JTicsXHJcbiAgJ2FkbWluJzogJ0FETUlOJyxcclxuICAnQWRtaW4nOiAnQURNSU4nLFxyXG4gICfZhdiv24zYsSc6ICdBRE1JTicsXHJcbiAgJ3VzZXInOiAnVVNFUicsXHJcbiAgJ9qp2KfYsdio2LEnOiAnVVNFUicsXHJcbiAgJ9qp2KfYsdio2LEg2LnYp9iv24wnOiAnVVNFUicsXHJcbiAgJ1VTRVInOiAnVVNFUicsXHJcbiAgJ9iv2KfZhti02KzZiCc6ICdTVFVERU5UJyxcclxuICAnc3R1ZGVudCc6ICdTVFVERU5UJyxcclxuICAnU1RVREVOVCc6ICdTVFVERU5UJyxcclxuICAn2KfYs9iq2KfYryc6ICdJTlNUUlVDVE9SJyxcclxuICAndGVhY2hlcic6ICdJTlNUUlVDVE9SJyxcclxuICAnaW5zdHJ1Y3Rvcic6ICdJTlNUUlVDVE9SJyxcclxuICAnSU5TVFJVQ1RPUic6ICdJTlNUUlVDVE9SJyxcclxufTtcclxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZVJvbGUocm9sZTogc3RyaW5nKSB7XHJcbiAgcmV0dXJuIHJvbGVNYXBbcm9sZV0gfHwgJ1VTRVInO1xyXG59ICJdLCJuYW1lcyI6WyJyb2xlTWFwIiwibm9ybWFsaXplUm9sZSIsInJvbGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/utils/roleMap.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fusers&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cusers%5Cindex.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();